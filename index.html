<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facturier Styl'Emoi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .sidebar-item.active { background: linear-gradient(to right, #f59e0b, #ea580c); }
        .btn-primary { background: linear-gradient(to right, #f59e0b, #ea580c); }
        .btn-primary:hover { background: linear-gradient(to right, #d97706, #dc2626); }
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            @page { size: A4; margin: 15mm; }
            .page-break { page-break-after: always; }
        }
        .logo-container { max-width: 200px; max-height: 80px; }
        .logo-container img { max-width: 100%; max-height: 80px; object-fit: contain; }
    </style>
</head>
<body class="bg-gradient-to-br from-stone-100 to-amber-50 min-h-screen">
    <!-- Page de Connexion -->
    <div id="login-page" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <img id="login-logo" src="" alt="Styl'Emoi" class="mx-auto h-24 mb-4">
                <h1 class="text-2xl font-bold text-stone-800">Facturier Styl'Emoi</h1>
                <p class="text-stone-500">Connectez-vous pour accéder à votre espace</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-stone-700 mb-1">Mot de passe</label>
                    <input type="password" id="login-password" onkeypress="if(event.key==='Enter')login()" 
                           class="w-full px-4 py-3 border border-stone-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-amber-500" 
                           placeholder="Entrez votre mot de passe">
                </div>
                <div id="login-error" class="hidden text-red-500 text-sm text-center">Mot de passe incorrect</div>
                <button onclick="login()" class="w-full btn-primary text-white py-3 rounded-lg font-semibold hover:shadow-lg transition-all">
                    Se connecter
                </button>
            </div>
        </div>
    </div>

    <div id="app" class="hidden flex min-h-screen">
        <!-- Sidebar FIXE -->
        <aside class="w-64 bg-gradient-to-b from-stone-900 to-stone-800 text-white flex flex-col h-screen sticky top-0 no-print">
            <div class="p-6 border-b border-stone-700">
                <div id="sidebar-logo" class="logo-container cursor-pointer" onclick="navigateTo('settings')" title="Cliquez pour changer le logo">
                    <!-- Logo ou texte par défaut -->
                </div>
                <p class="text-stone-400 text-sm mt-1" id="version-display">v3.0.0</p>
            </div>
            <nav class="flex-1 p-4 space-y-1 overflow-y-auto" id="nav-menu"></nav>
            <div class="p-4 border-t border-stone-700 text-stone-400 text-xs">© 2024 Styl'Emoi</div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 p-8 overflow-auto" id="main-content"></main>
    </div>

    <!-- Modal Container -->
    <div id="modal-container" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden z-50 flex items-center justify-center p-4">
        <div id="modal-content" class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto"></div>
    </div>

    <!-- Zone d'impression cachée -->
    <div id="print-area" class="hidden print:block"></div>

<script>
// ============================================
// FIREBASE REALTIME DATABASE
// ============================================
const firebaseConfig = {
    apiKey: "AIzaSyAW0oncXlG74CoQmzIBwNuySPObG3Fn4rE",
    authDomain: "facturier-stylemoi.firebaseapp.com",
    databaseURL: "https://facturier-stylemoi-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "facturier-stylemoi",
    storageBucket: "facturier-stylemoi.firebasestorage.app",
    messagingSenderId: "662308649673",
    appId: "1:662308649673:web:0a658387c8762bc91beb18",
    measurementId: "G-73FEYNDN5Z"
};

let dbRef = null;
try {
    firebase.initializeApp(firebaseConfig);
    dbRef = firebase.database().ref('facturier');
    console.log('✅ Firebase Realtime Database connecté');
} catch(e) {
    console.error('❌ Erreur Firebase:', e);
}

// ============================================
// FONCTIONS DE CONNEXION
// ============================================
function login() {
    const password = document.getElementById('login-password').value;
    const storedData = localStorage.getItem('facturier_stylemoi_v3');
    let adminPassword = 'admin123';
    
    if (storedData) {
        try {
            const parsed = JSON.parse(storedData);
            if (parsed.adminPassword) adminPassword = parsed.adminPassword;
        } catch(e) {}
    }
    
    if (password === adminPassword) {
        document.getElementById('login-page').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        sessionStorage.setItem('facturier_logged', 'true');
        document.getElementById('login-error').classList.add('hidden');
        initApp();
    } else {
        document.getElementById('login-error').classList.remove('hidden');
        document.getElementById('login-password').value = '';
    }
}

function logout() {
    sessionStorage.removeItem('facturier_logged');
    document.getElementById('app').classList.add('hidden');
    document.getElementById('login-page').classList.remove('hidden');
    document.getElementById('login-password').value = '';
}

function checkSession() {
    // Charger le logo sur la page de connexion
    const storedData = localStorage.getItem('facturier_stylemoi_v3');
    let logoSrc = defaultData.logo; // Logo par défaut
    
    if (storedData) {
        try {
            const parsed = JSON.parse(storedData);
            if (parsed.logo) {
                logoSrc = parsed.logo;
            }
        } catch(e) {}
    }
    
    if (logoSrc) {
        document.getElementById('login-logo').src = logoSrc;
    }
    
    if (sessionStorage.getItem('facturier_logged') === 'true') {
        document.getElementById('login-page').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        initApp();
    }
}

function initApp() {
    loadData();
    renderNav();
    renderPage();
}

// ============================================
// DONNÉES PAR DÉFAUT
// ============================================
const defaultData = {
    version: '3.2.0',
    adminPassword: 'admin123',
    logo: 'data:image/jpeg;base64,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AFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABQBiiigAooooAKKKKAOX+Ff/JMPCH/AGB7P/0QldRXL/Cv/kmHhD/sD2f/AKISuorsxn+81f8AE/zOfD/wYei/IKKKK4zoCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAoopskixqSxwBQA6oZrqOEctz6CqFzqTOSqfKvrVIkls5yaDeNFy+Ivy6o5+4oUep5NUnleQ5ZifxpOvWrMOnyS842D1NBulCmVlORS7h61qR6ZEv3stU62kKdEFBHto9EYR60A4rf8mP8AuL+VBgjP8C/lQL2/kYOTSZrcayhfqgH04qtJpSMfkYr7HmgarRe6MscHIOPpViO8li+65PseaJ7GWA8jcPVagoNfdmtDQj1ZujoPqKtRX8Mn8W0+9YtGeKDN0YvY6IMD0OfpRWBHK8ZyrEVch1RgcSDcPUdaDGVKS21NOio4biOcfIckdRUlBltuFFFFAgooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooA5f4V/8kw8If8AYHs//RCV1Fcv8K/+SYeEP+wPZ/8AohK6iuzGf7zV/wAT/M58P/Bh6L8gooorjOgKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKSRhGhc8KO9ADJ7hbdCzfgPWsee5e5bLcDsKS5uDcSFicjsKiFB2U6ajr1CnRoZHCqMk0KhZgAMk9q17OzW3XJHznrQXOfIhLSxWEBmwz+/arVFFBwttu7CiiigQUUUUAFFFFAAeap3OnrMCUG1/wCdXKKATcXdHPvG0bFWGCKbWzfWv2hCV4cdD61jYIOCMEdqDupz515hnigUo6UlBqaWkxnEjnucVoVV00YtR7nNWqDzpO8mwooooJCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigDl/hX/wAkw8If9gez/wDRCV1Fcv8ACv8A5Jh4Q/7A9n/6ISuorsxn+81f8T/M58P/AAYei/IKKKK4zoCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACszUrne3lg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UVxnQFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFAHL/Cv/AJJh4Q/7A9n/AOiErqK5f4V/8kw8If8AYHs//RCV1FdmM/3mr/if5nPh/wCDD0X5BRRRXGdAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAFFFFABRRRQAUUUUAcv8K/8AkmHhD/sD2f8A6ISuooorsxn+81f8T/M58P8AwYei/IKKKK4zoCiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigAooooAKKKKACiiigD/2Q==', // Base64 du logo
    cgv: `CONDITIONS GÉNÉRALES DE VENTE

1. OBJET
Les présentes conditions générales de vente s'appliquent à toutes les ventes conclues par Styl'Emoi.

2. PRIX
Les prix sont indiqués en euros. TVA non applicable, article 293B du CGI.

3. PAIEMENT
Le paiement est exigible à la commande ou selon les modalités convenues.

4. LIVRAISON
Les délais de livraison sont donnés à titre indicatif.

5. RÉCLAMATIONS
Toute réclamation doit être formulée dans un délai de 7 jours suivant la livraison.

6. DROIT DE RÉTRACTATION
Conformément à la loi, le client dispose d'un délai de 14 jours pour exercer son droit de rétractation. Les produits personnalisés ne peuvent faire l'objet d'un retour.

7. GARANTIE
Nos produits bénéficient de la garantie légale de conformité.

8. DONNÉES PERSONNELLES
Les données collectées sont utilisées uniquement pour le traitement des commandes.

9. LITIGES
En cas de litige, une solution amiable sera recherchée. À défaut, les tribunaux de Strasbourg seront compétents.`,
    entreprise: {
        nom: "Styl'Emoi",
        complement: 'Entrepreneur individuel',
        adresse: '6G Rue de la Mésange',
        codePostal: '67110',
        ville: 'NIEDERBRONN-LES-BAINS',
        telephone: '06 71 66 81 02',
        email: 'contact@stylemoi.fr',
        siret: '933 150 773 000 10',
        rcs: 'RCS Strasbourg 933 150 773 Code APE 4791A',
        iban: 'FR76 10 27 8017 8000 0206 0130 132',
        bic: 'CMCIFR2A',
        exonereTVA: true
    },
    // Taux URSSAF par mois (clé: YYYY-MM, valeur: taux)
    tauxURSSAFParMois: {
        'default': 23.20
    },
    tauxTVA: [0, 5.5, 10, 20],
    moyensReglement: ['chèque', 'virement', 'carte bancaire', 'espèces', 'paypal', 'CB', 'à définir'],
    categories: [
        { id: 'tasses', nom: 'Tasses', icon: '☕' },
        { id: 'gourdes', nom: 'Gourdes', icon: '🍶' },
        { id: 'verres', nom: 'Verres', icon: '🥛' },
        { id: 'ardoises', nom: 'Ardoises', icon: '🪨' },
        { id: 'panneaux', nom: 'Panneaux', icon: '🖼️' },
        { id: 'cuisine', nom: 'Cuisine', icon: '🍳' },
        { id: 'tabliers', nom: 'Tabliers', icon: '👔' },
        { id: 'boites', nom: 'Boîtes', icon: '📦' },
        { id: 'accessoires', nom: 'Accessoires', icon: '🎁' },
        { id: 'coussins', nom: 'Coussins', icon: '🛋️' },
        { id: 'tshirts', nom: 'T-shirts', icon: '👕' },
        { id: 'bebe', nom: 'Bébé', icon: '👶' },
        { id: 'serviettes', nom: 'Serviettes', icon: '🛁' },
        { id: 'divers', nom: 'Divers', icon: '📋' }
    ],
    clients: [
        { numero: 'C00001', type: 'Professionnel', nom: 'WALTER Patrice', adresse: '3 rue des Hirondelles', codePostal: '67110', ville: 'GUNDERSHOFFEN', telephone: '', portable: '06 37 70 37 31', email: 'walterpatrice67@gmail.com' },
        { numero: 'C00002', type: 'Particulier', nom: 'CHRISTMANN Corine', adresse: '19 route de Philippsbourg', codePostal: '67110', ville: 'Neunhoffen', telephone: '', portable: '06 85 68 72 96', email: '' },
        { numero: 'C00003', type: 'Particulier', nom: 'RAKOTOSALAMA Rojo', adresse: '20 rue de Lobsann', codePostal: '67250', ville: 'Soultz-sous-Forêts', telephone: '', portable: '648865782', email: 'rojorakotosalama@yahoo.fr' },
        { numero: 'C00004', type: 'Particulier', nom: 'Ferri Céline', adresse: '19 rue sœur Marie', codePostal: '67500', ville: 'Weitbruch', telephone: '', portable: '622005989', email: '' },
        { numero: 'C00005', type: 'Particulier', nom: 'Wingert Leslie', adresse: '5 rue de la Rotlach', codePostal: '67850', ville: 'Herrlisheim', telephone: '', portable: '', email: '' },
        { numero: 'C00006', type: 'Particulier', nom: 'Schmitt Audrey', adresse: '1 passage du Murin', codePostal: '67500', ville: 'Haguenau', telephone: '', portable: '614145487', email: '' },
        { numero: 'C00007', type: 'Particulier', nom: 'Waechter Andrée', adresse: '7 rue de la Sablonière', codePostal: '67110', ville: 'Reichshoffen', telephone: '', portable: '786493984', email: '' },
        { numero: 'C00008', type: 'Particulier', nom: 'Brunner Emmanuelle', adresse: '42 rue des roseaux', codePostal: '67590', ville: 'Schweighouse-sur-Moder', telephone: '', portable: '671815064', email: '' },
        { numero: 'C00009', type: 'Particulier', nom: 'Weibel Joelle', adresse: '7 IMPASSES DES JARDINS', codePostal: '67590', ville: 'OHLUNGEN', telephone: '', portable: '626102755', email: '' },
        { numero: 'C00010', type: 'Particulier', nom: 'GITZ MORGANE', adresse: '91 RUE PRINCIPALE', codePostal: '67590', ville: 'OHLUNGEN', telephone: '', portable: '620951401', email: '' },
        { numero: 'C00011', type: 'Particulier', nom: 'Restaurant les Cordons Bleus', adresse: '20 rue Principale', codePostal: '67250', ville: 'Lobsann', telephone: '', portable: '624185568', email: '' },
        { numero: 'C00012', type: 'Particulier', nom: 'CHRISTMANN DELPHINE', adresse: '18 CITE NAPOLEON', codePostal: '67660', ville: 'BETCHDORF', telephone: '', portable: '681615580', email: '' },
        { numero: 'C00013', type: 'Particulier', nom: 'Virginie', adresse: '21 rue des vergers', codePostal: '68640', ville: 'Waldighoffen', telephone: '', portable: '683674047', email: 'Booggybooggy68@gmail.com' },
        { numero: 'C00014', type: 'Particulier', nom: 'FROBERGER KERLEN GAELLE', adresse: '3 RUE DE LARGITZEN', codePostal: '68560', ville: 'Hirsingue', telephone: '', portable: '688813905', email: 'greg.gaelle51@hotmail.fr' },
        { numero: 'C00015', type: 'Particulier', nom: 'Elodie', adresse: '', codePostal: '', ville: '', telephone: '', portable: '', email: '' },
        { numero: 'C00016', type: 'Particulier', nom: 'Marion', adresse: '', codePostal: '', ville: '', telephone: '', portable: '', email: '' },
        { numero: 'C00017', type: 'Particulier', nom: 'Association des cerfs solidaires', adresse: '', codePostal: '67360', ville: 'Langensoultzbach', telephone: '', portable: '', email: '' },
        { numero: 'C00018', type: 'Particulier', nom: 'AAPPMA Gundershoffen', adresse: '', codePostal: '67110', ville: 'Gundershoffen', telephone: '', portable: '', email: '' },
        { numero: 'C00019', type: 'Particulier', nom: 'hoernel antoine', adresse: '', codePostal: '67110', ville: 'Gundershoffen', telephone: '', portable: '', email: '' },
        { numero: 'C00020', type: 'Particulier', nom: 'CSE fonderie de Niederbronn', adresse: '', codePostal: '67110', ville: 'Niederbronn les bains', telephone: '', portable: '', email: 'Georges.VOLTZ@fonderiedeniederbronn.com' },
        { numero: 'C00021', type: 'Particulier', nom: 'weiss maria', adresse: '', codePostal: '', ville: 'sessenheim', telephone: '', portable: '', email: '' },
        { numero: 'C00022', type: 'Particulier', nom: 'CANARELLI CELINE', adresse: '', codePostal: '44320', ville: 'CHAUMES EN RETZ', telephone: '', portable: '', email: '' },
        { numero: 'C00023', type: 'Particulier', nom: 'Klein Fabienne', adresse: '', codePostal: '67110', ville: 'Reichshoffen', telephone: '', portable: '', email: '' },
    ],
    produits: [
        // TASSES - T001 à T018
        { reference: 'T001', description: 'Tasse blanche céramique', prixHT: 12.00, tauxTVA: 0, coutAchat: 1.32, marge: 8.09, categorie: 'tasses' },
        { reference: 'T002', description: 'Tasse émail 450 ml personnalisée', prixHT: 15.00, tauxTVA: 0, coutAchat: 3.62, marge: 3.15, categorie: 'tasses' },
        { reference: 'T003', description: 'Tasse inox 400 ml personnalisée', prixHT: 15.00, tauxTVA: 0, coutAchat: 5.05, marge: 1.97, categorie: 'tasses' },
        { reference: 'T004', description: 'Tasse plastique', prixHT: 0, tauxTVA: 0, coutAchat: 3.09, marge: 0, categorie: 'tasses' },
        { reference: 'T005', description: 'Tasse conique', prixHT: 0, tauxTVA: 0, coutAchat: 3.64, marge: 0, categorie: 'tasses' },
        { reference: 'T006', description: 'Tasse Waouh', prixHT: 15.00, tauxTVA: 0, coutAchat: 2.44, marge: 5.15, categorie: 'tasses' },
        { reference: 'T007', description: 'Tasse noir int blanc', prixHT: 0, tauxTVA: 0, coutAchat: 0, marge: 0, categorie: 'tasses' },
        { reference: 'T008', description: 'Tasse en verre jaune', prixHT: 15.00, tauxTVA: 0, coutAchat: 3.37, marge: 3.45, categorie: 'tasses' },
        { reference: 'T009', description: 'Tasse en verre violet', prixHT: 15.00, tauxTVA: 0, coutAchat: 3.37, marge: 3.45, categorie: 'tasses' },
        { reference: 'T010', description: 'Tasse en verre bleu', prixHT: 15.00, tauxTVA: 0, coutAchat: 3.37, marge: 3.45, categorie: 'tasses' },
        { reference: 'T011', description: 'Tasse paillette gris bleu', prixHT: 15.00, tauxTVA: 0, coutAchat: 2.98, marge: 4.04, categorie: 'tasses' },
        { reference: 'T012', description: 'Tasse paillette gris rose', prixHT: 15.00, tauxTVA: 0, coutAchat: 2.87, marge: 4.23, categorie: 'tasses' },
        { reference: 'T013', description: 'Tasse paillette gris jaune', prixHT: 15.00, tauxTVA: 0, coutAchat: 2.87, marge: 4.23, categorie: 'tasses' },
        { reference: 'T014', description: 'Tasse paillette rose jaune', prixHT: 15.00, tauxTVA: 0, coutAchat: 2.98, marge: 4.04, categorie: 'tasses' },
        { reference: 'T015', description: 'Tasse paillette rose bleu', prixHT: 15.00, tauxTVA: 0, coutAchat: 2.98, marge: 4.04, categorie: 'tasses' },
        { reference: 'T016', description: 'Mug thermos Inox 470 ml', prixHT: 20.00, tauxTVA: 0, coutAchat: 8.40, marge: 1.38, categorie: 'tasses' },
        { reference: 'T017', description: 'Mug thermos Inox 390ml', prixHT: 1.00, tauxTVA: 0, coutAchat: 6.66, marge: 0, categorie: 'tasses' },
        { reference: 'T018', description: 'Boite pour tasse en céramique', prixHT: 1.00, tauxTVA: 0, coutAchat: 1.00, marge: 0, categorie: 'tasses' },
        { reference: 'T019', description: 'Choppe à bière 500ML', prixHT: 18.00, tauxTVA: 0, coutAchat: 4.80, marge: 2.75, categorie: 'tasses' },
        { reference: 'T020', description: 'Bol en céramique petit', prixHT: 20.00, tauxTVA: 0, coutAchat: 6.16, marge: 2.25, categorie: 'tasses' },
        { reference: 'T021', description: 'Bol céréales céramique', prixHT: 18.00, tauxTVA: 0, coutAchat: 5.83, marge: 2.09, categorie: 'tasses' },
        // GOURDES - G001 à G014
        { reference: 'G001', description: 'Gourde Iso inox 500ML Blanche', prixHT: 18.00, tauxTVA: 0, coutAchat: 7.54, marge: 1.39, categorie: 'gourdes' },
        { reference: 'G002', description: 'Gourde Iso inox 500ML violet', prixHT: 18.00, tauxTVA: 0, coutAchat: 8.01, marge: 1.25, categorie: 'gourdes' },
        { reference: 'G003', description: 'Gourde Iso inox 500ML rose/blanc', prixHT: 18.00, tauxTVA: 0, coutAchat: 8.01, marge: 1.25, categorie: 'gourdes' },
        { reference: 'G004', description: 'Gourde Iso inox 500ML bleu/vert', prixHT: 18.00, tauxTVA: 0, coutAchat: 8.01, marge: 1.25, categorie: 'gourdes' },
        { reference: 'G005', description: 'Gourde sport Alu Gris 500ML', prixHT: 13.00, tauxTVA: 0, coutAchat: 4.27, marge: 2.05, categorie: 'gourdes' },
        { reference: 'G006', description: 'Gourde sport Alu Blanc 500ML', prixHT: 13.00, tauxTVA: 0, coutAchat: 4.27, marge: 2.05, categorie: 'gourdes' },
        { reference: 'G007', description: 'Bouteille iso inox Blanc/Gris 750ML', prixHT: 20.00, tauxTVA: 0, coutAchat: 8.26, marge: 1.42, categorie: 'gourdes' },
        { reference: 'G008', description: 'Bouteille iso inox Gris 750ML', prixHT: 20.00, tauxTVA: 0, coutAchat: 8.26, marge: 1.42, categorie: 'gourdes' },
        { reference: 'G009', description: 'Bouteille iso inox Blanc 750ML', prixHT: 20.00, tauxTVA: 0, coutAchat: 8.26, marge: 1.42, categorie: 'gourdes' },
        { reference: 'G010', description: 'Thermos Inox 750ML Gris+Gobelet', prixHT: 22.00, tauxTVA: 0, coutAchat: 10.31, marge: 1.13, categorie: 'gourdes' },
        { reference: 'G011', description: 'Thermos Inox 750ML Blanc+Gobelet', prixHT: 22.00, tauxTVA: 0, coutAchat: 10.31, marge: 1.13, categorie: 'gourdes' },
        { reference: 'G012', description: 'Cannette iso inox 380Ml', prixHT: 20.00, tauxTVA: 0, coutAchat: 8.25, marge: 1.42, categorie: 'gourdes' },
        { reference: 'G013', description: 'Gobelet cannette subli', prixHT: 18.00, tauxTVA: 0, coutAchat: 7.50, marge: 1.40, categorie: 'gourdes' },
        // VERRES - V001 à V004
        { reference: 'V001', description: 'Verre cannette avec paille givré', prixHT: 20.00, tauxTVA: 0, coutAchat: 10.00, marge: 1.00, categorie: 'verres' },
        { reference: 'V002', description: 'Verre cannette avec paille bleu', prixHT: 20.00, tauxTVA: 0, coutAchat: 10.00, marge: 1.00, categorie: 'verres' },
        { reference: 'V003', description: 'Verre cannette avec paille vert', prixHT: 20.00, tauxTVA: 0, coutAchat: 10.00, marge: 1.00, categorie: 'verres' },
        { reference: 'V004', description: 'Verre cannette avec paille transparent', prixHT: 18.00, tauxTVA: 0, coutAchat: 8.00, marge: 1.25, categorie: 'verres' },
        // ARDOISES - A001 à A009
        { reference: 'A001', description: 'Ardoise carrée 15x15', prixHT: 15.00, tauxTVA: 0, coutAchat: 4.94, marge: 2.04, categorie: 'ardoises' },
        { reference: 'A002', description: 'Ardoise carrée 20x20', prixHT: 20.00, tauxTVA: 0, coutAchat: 8.20, marge: 1.44, categorie: 'ardoises' },
        { reference: 'A003', description: 'Ardoise carrée 30x30', prixHT: 30.00, tauxTVA: 0, coutAchat: 9.89, marge: 2.03, categorie: 'ardoises' },
        { reference: 'A004', description: 'Ardoise rectangulaire 20x30', prixHT: 20.00, tauxTVA: 0, coutAchat: 8.20, marge: 1.44, categorie: 'ardoises' },
        { reference: 'A005', description: 'Ardoise rectangulaire 15x20', prixHT: 15.00, tauxTVA: 0, coutAchat: 5.53, marge: 1.71, categorie: 'ardoises' },
        { reference: 'A006', description: 'Ardoise cœur', prixHT: 20.00, tauxTVA: 0, coutAchat: 8.35, marge: 1.40, categorie: 'ardoises' },
        { reference: 'A007', description: 'Ardoise croix', prixHT: 20.00, tauxTVA: 0, coutAchat: 8.35, marge: 1.40, categorie: 'ardoises' },
        { reference: 'A008', description: 'Ardoise ovale', prixHT: 18.00, tauxTVA: 0, coutAchat: 6.90, marge: 1.61, categorie: 'ardoises' },
        { reference: 'A009', description: 'Ardoise horloge', prixHT: 40.00, tauxTVA: 0, coutAchat: 15.90, marge: 1.52, categorie: 'ardoises' },
        // BOITES - BO001 à BO005
        { reference: 'BO001', description: 'Boîte à gouter Bleu Clair', prixHT: 15.00, tauxTVA: 0, coutAchat: 5.34, marge: 1.81, categorie: 'boites' },
        { reference: 'BO002', description: 'Boîte à gouter Bleu foncé', prixHT: 15.00, tauxTVA: 0, coutAchat: 5.34, marge: 1.81, categorie: 'boites' },
        { reference: 'BO003', description: 'Boîte à gouter Vert', prixHT: 15.00, tauxTVA: 0, coutAchat: 5.34, marge: 1.81, categorie: 'boites' },
        { reference: 'BO004', description: 'Boîte à gouter Rose', prixHT: 15.00, tauxTVA: 0, coutAchat: 5.34, marge: 1.81, categorie: 'boites' },
        { reference: 'BO005', description: 'Boîte à gouter Rouge', prixHT: 15.00, tauxTVA: 0, coutAchat: 5.34, marge: 1.81, categorie: 'boites' },
        // PANNEAUX - PA001 à PA011
        { reference: 'PA001', description: 'Panneau acrylique 100x150', prixHT: 8.00, tauxTVA: 0, coutAchat: 2.38, marge: 2.36, categorie: 'panneaux' },
        { reference: 'PA002', description: 'Panneau acrylique 150x200', prixHT: 10.00, tauxTVA: 0, coutAchat: 4.65, marge: 1.15, categorie: 'panneaux' },
        { reference: 'PA003', description: 'Panneau acrylique 150x300', prixHT: 15.00, tauxTVA: 0, coutAchat: 6.66, marge: 1.25, categorie: 'panneaux' },
        { reference: 'PA004', description: 'Panneau acrylique 200x250', prixHT: 18.00, tauxTVA: 0, coutAchat: 7.38, marge: 1.44, categorie: 'panneaux' },
        { reference: 'PA005', description: 'Panneau acrylique 200x300', prixHT: 22.00, tauxTVA: 0, coutAchat: 10.25, marge: 1.15, categorie: 'panneaux' },
        { reference: 'PA006', description: 'Panneau acrylique 100x200', prixHT: 8.50, tauxTVA: 0, coutAchat: 3.56, marge: 1.39, categorie: 'panneaux' },
        { reference: 'PA007', description: 'Plaque photo Alu 12,5x17,5', prixHT: 0, tauxTVA: 0, coutAchat: 0, marge: 0, categorie: 'panneaux' },
        { reference: 'PA008', description: 'Panneau en verre 178x127', prixHT: 15.00, tauxTVA: 0, coutAchat: 6.80, marge: 1.21, categorie: 'panneaux' },
        { reference: 'PA009', description: 'Panneau en verre 127x178', prixHT: 15.00, tauxTVA: 0, coutAchat: 6.80, marge: 1.21, categorie: 'panneaux' },
        { reference: 'PA010', description: 'Panneau en verre 250x203', prixHT: 20.00, tauxTVA: 0, coutAchat: 9.88, marge: 1.02, categorie: 'panneaux' },
        { reference: 'PA011', description: 'Panneau en verre 203x250', prixHT: 20.00, tauxTVA: 0, coutAchat: 9.88, marge: 1.02, categorie: 'panneaux' },
        // CUISINE - CU001 à CU008
        { reference: 'CU001', description: 'Gant cuisine', prixHT: 6.00, tauxTVA: 0, coutAchat: 2.91, marge: 1.06, categorie: 'cuisine' },
        { reference: 'CU002', description: 'Manique cuisine', prixHT: 6.00, tauxTVA: 0, coutAchat: 2.91, marge: 1.06, categorie: 'cuisine' },
        { reference: 'CU003', description: 'Planche à découper polymère 235x140', prixHT: 12.50, tauxTVA: 0, coutAchat: 4.36, marge: 1.87, categorie: 'cuisine' },
        { reference: 'CU004', description: 'Planche à découper polymère 200x250', prixHT: 15.00, tauxTVA: 0, coutAchat: 5.60, marge: 1.68, categorie: 'cuisine' },
        { reference: 'CU005', description: 'Planche à découper verre ronde 300', prixHT: 7.77, tauxTVA: 0, coutAchat: 7.77, marge: 0, categorie: 'cuisine' },
        { reference: 'CU006', description: 'Planche à découper verre 285x391', prixHT: 7.60, tauxTVA: 0, coutAchat: 7.60, marge: 0, categorie: 'cuisine' },
        { reference: 'CU007', description: 'Planche à découper verre 200x285', prixHT: 5.86, tauxTVA: 0, coutAchat: 5.86, marge: 0, categorie: 'cuisine' },
        { reference: 'CU008', description: 'Carrelage en verre 152x152', prixHT: 2.35, tauxTVA: 0, coutAchat: 2.35, marge: 0, categorie: 'cuisine' },
        // TABLIERS - TA001 à TA004
        { reference: 'TA001', description: 'Tablier Enfant 360x510', prixHT: 2.37, tauxTVA: 0, coutAchat: 2.37, marge: 0, categorie: 'tabliers' },
        { reference: 'TA002', description: 'Tablier Enfant 480x650', prixHT: 2.74, tauxTVA: 0, coutAchat: 2.74, marge: 0, categorie: 'tabliers' },
        { reference: 'TA003', description: 'Tablier Adulte 600x850', prixHT: 4.90, tauxTVA: 0, coutAchat: 4.90, marge: 0, categorie: 'tabliers' },
        { reference: 'TA004', description: 'Tablier Adulte 700x950', prixHT: 6.15, tauxTVA: 0, coutAchat: 6.15, marge: 0, categorie: 'tabliers' },
        // ACCESSOIRES - AC001 à AC019
        { reference: 'AC001', description: 'Badge Aimanté 75x50mm', prixHT: 1.07, tauxTVA: 0, coutAchat: 1.07, marge: 0, categorie: 'accessoires' },
        { reference: 'AC002', description: 'Magnet Cœur', prixHT: 2.18, tauxTVA: 0, coutAchat: 2.18, marge: 0, categorie: 'accessoires' },
        { reference: 'AC003', description: 'Tapis de souris', prixHT: 8.00, tauxTVA: 0, coutAchat: 1.60, marge: 4.00, categorie: 'accessoires' },
        { reference: 'AC004', description: 'Zippo', prixHT: 0, tauxTVA: 0, coutAchat: 0, marge: 0, categorie: 'accessoires' },
        { reference: 'AC005', description: 'Tirelire', prixHT: 10.00, tauxTVA: 0, coutAchat: 3.31, marge: 2.02, categorie: 'accessoires' },
        { reference: 'AC006', description: 'Porte Carte Bois avec ou sans prénom', prixHT: 2.50, tauxTVA: 0, coutAchat: 2.50, marge: 0, categorie: 'accessoires' },
        { reference: 'AC007', description: 'Dessous de Verre sublimable', prixHT: 0, tauxTVA: 0, coutAchat: 0, marge: 0, categorie: 'accessoires' },
        { reference: 'AC008', description: 'Lingettes Lunettes Sublimable', prixHT: 0, tauxTVA: 0, coutAchat: 0, marge: 0, categorie: 'accessoires' },
        { reference: 'AC009', description: 'Décapsuleur Metal', prixHT: 0, tauxTVA: 0, coutAchat: 0, marge: 0, categorie: 'accessoires' },
        { reference: 'AC010', description: 'Décapsuleur Bois', prixHT: 0, tauxTVA: 0, coutAchat: 0, marge: 0, categorie: 'accessoires' },
        { reference: 'AC011', description: 'Marque page 95mm', prixHT: 0, tauxTVA: 0, coutAchat: 0, marge: 0, categorie: 'accessoires' },
        { reference: 'AC012', description: 'Cabas tissus', prixHT: 0, tauxTVA: 0, coutAchat: 0, marge: 0, categorie: 'accessoires' },
        { reference: 'AC013', description: 'Lampe sublimable', prixHT: 0, tauxTVA: 0, coutAchat: 0, marge: 0, categorie: 'accessoires' },
        { reference: 'AC014', description: 'Horloge Mural sublimable', prixHT: 11.44, tauxTVA: 0, coutAchat: 11.44, marge: 0, categorie: 'accessoires' },
        { reference: 'AC015', description: 'Puzzle', prixHT: 10.00, tauxTVA: 0, coutAchat: 3.50, marge: 1.86, categorie: 'accessoires' },
        { reference: 'AC016', description: 'Pendentif os alu', prixHT: 5.00, tauxTVA: 0, coutAchat: 1.75, marge: 1.86, categorie: 'accessoires' },
        // COUSSINS - CO001 à CO007
        { reference: 'CO001', description: 'Coussin Coeur 40x44cm + housse sublimable', prixHT: 6.00, tauxTVA: 0, coutAchat: 6.00, marge: 0, categorie: 'coussins' },
        { reference: 'CO002', description: 'Coussin carré 35x35cm + housse sublimable', prixHT: 4.91, tauxTVA: 0, coutAchat: 4.91, marge: 0, categorie: 'coussins' },
        { reference: 'CO003', description: 'Coussin carré 40x40cm + housse sublimable', prixHT: 5.20, tauxTVA: 0, coutAchat: 5.20, marge: 0, categorie: 'coussins' },
        { reference: 'CO004', description: 'Coussin carré 45x45cm + housse sublimable', prixHT: 6.68, tauxTVA: 0, coutAchat: 6.68, marge: 0, categorie: 'coussins' },
        { reference: 'CO005', description: 'Coussin rectangulaire 80x40cm + housse sublimable', prixHT: 10.17, tauxTVA: 0, coutAchat: 10.17, marge: 0, categorie: 'coussins' },
        { reference: 'CO006', description: 'Bouillotte + Housse', prixHT: 8.06, tauxTVA: 0, coutAchat: 8.06, marge: 0, categorie: 'coussins' },
        // T-SHIRTS - TS001 à TS022
        { reference: 'TS001', description: 'TSHIRT POLY BLEU TOUCHER COTON S-XL', prixHT: 10.08, tauxTVA: 0, coutAchat: 10.08, marge: 0, categorie: 'tshirts' },
        { reference: 'TS002', description: 'TSHIRT POLY BLEU TOUCHER COTON 2XL', prixHT: 11.22, tauxTVA: 0, coutAchat: 11.22, marge: 0, categorie: 'tshirts' },
        { reference: 'TS003', description: 'TSHIRT POLY BLEU TOUCHER COTON 3XL', prixHT: 11.82, tauxTVA: 0, coutAchat: 11.82, marge: 0, categorie: 'tshirts' },
        { reference: 'TS004', description: 'TSHIRT POLY GRIS TOUCHER COTON S-XL', prixHT: 10.08, tauxTVA: 0, coutAchat: 10.08, marge: 0, categorie: 'tshirts' },
        { reference: 'TS005', description: 'TSHIRT POLY GRIS TOUCHER COTON 2XL', prixHT: 11.22, tauxTVA: 0, coutAchat: 11.22, marge: 0, categorie: 'tshirts' },
        { reference: 'TS006', description: 'TSHIRT POLY GRIS TOUCHER COTON 3XL', prixHT: 11.82, tauxTVA: 0, coutAchat: 11.82, marge: 0, categorie: 'tshirts' },
        { reference: 'TS007', description: 'TSHIRT POLY BLANC TOUCHER COTON S-XL', prixHT: 10.08, tauxTVA: 0, coutAchat: 10.08, marge: 0, categorie: 'tshirts' },
        { reference: 'TS008', description: 'TSHIRT POLY BLANC TOUCHER COTON 2XL', prixHT: 11.22, tauxTVA: 0, coutAchat: 11.22, marge: 0, categorie: 'tshirts' },
        { reference: 'TS009', description: 'TSHIRT POLY BLANC TOUCHER COTON 3XL', prixHT: 11.82, tauxTVA: 0, coutAchat: 11.82, marge: 0, categorie: 'tshirts' },
        { reference: 'TS010', description: 'TSHIRT POLY VERT TOUCHER COTON S-XL', prixHT: 10.80, tauxTVA: 0, coutAchat: 10.80, marge: 0, categorie: 'tshirts' },
        { reference: 'TS011', description: 'TSHIRT POLY VERT TOUCHER COTON 2XL', prixHT: 11.22, tauxTVA: 0, coutAchat: 11.22, marge: 0, categorie: 'tshirts' },
        { reference: 'TS012', description: 'TSHIRT POLY VERT TOUCHER COTON 3XL', prixHT: 11.82, tauxTVA: 0, coutAchat: 11.82, marge: 0, categorie: 'tshirts' },
        { reference: 'TS013', description: 'TSHIRT POLY VERT TOUCHER COTON MIXTE S-XL', prixHT: 9.12, tauxTVA: 0, coutAchat: 9.12, marge: 0, categorie: 'tshirts' },
        { reference: 'TS014', description: 'TSHIRT POLY VERT TOUCHER COTON MIXTE 2XL', prixHT: 10.74, tauxTVA: 0, coutAchat: 10.74, marge: 0, categorie: 'tshirts' },
        { reference: 'TS015', description: 'TSHIRT POLY VERT TOUCHER COTON MIXTE 3XL', prixHT: 11.10, tauxTVA: 0, coutAchat: 11.10, marge: 0, categorie: 'tshirts' },
        { reference: 'TS016', description: 'TSHIRT POLY VERT TOUCHER COTON MIXTE 4XL', prixHT: 11.76, tauxTVA: 0, coutAchat: 11.76, marge: 0, categorie: 'tshirts' },
        { reference: 'TS017', description: 'TSHIRT POLY VERT TOUCHER COTON MIXTE 5XL', prixHT: 13.32, tauxTVA: 0, coutAchat: 13.32, marge: 0, categorie: 'tshirts' },
        { reference: 'TS018', description: 'TSHIRT POLY BLANC TOUCHER COTON ENFANT 2-16 ANS', prixHT: 7.62, tauxTVA: 0, coutAchat: 7.62, marge: 0, categorie: 'tshirts' },
        { reference: 'TS019', description: 'TSHIRT POLY COL V FEMME S-5XL', prixHT: 5.83, tauxTVA: 0, coutAchat: 5.83, marge: 0, categorie: 'tshirts' },
        { reference: 'TS020', description: 'TSHIRT POLY COL V HOMME S-5XL', prixHT: 5.83, tauxTVA: 0, coutAchat: 5.83, marge: 0, categorie: 'tshirts' },
        { reference: 'TS021', description: 'Tshirt rechange', prixHT: 0.96, tauxTVA: 0, coutAchat: 0.96, marge: 0, categorie: 'tshirts' },
        { reference: 'TS022', description: 'Tshirt rechange 2xl', prixHT: 2.82, tauxTVA: 0, coutAchat: 2.82, marge: 0, categorie: 'tshirts' },
        // BEBE - BE001 à BE012
        { reference: 'BE001', description: 'Body Bébé Poly Ultra Doux', prixHT: 5.32, tauxTVA: 0, coutAchat: 5.32, marge: 0, categorie: 'bebe' },
        { reference: 'BE002', description: 'Bavoir Blanc', prixHT: 3.10, tauxTVA: 0, coutAchat: 3.10, marge: 0, categorie: 'bebe' },
        { reference: 'BE003', description: 'Doudou Mouton (xl)', prixHT: 5.48, tauxTVA: 0, coutAchat: 5.48, marge: 0, categorie: 'bebe' },
        { reference: 'BE004', description: 'Doudou Girafe (l)', prixHT: 5.48, tauxTVA: 0, coutAchat: 5.48, marge: 0, categorie: 'bebe' },
        { reference: 'BE005', description: 'Doudou Elephant (xl)', prixHT: 5.48, tauxTVA: 0, coutAchat: 5.48, marge: 0, categorie: 'bebe' },
        { reference: 'BE006', description: 'Doudou Ours (l) 220mm', prixHT: 5.93, tauxTVA: 0, coutAchat: 5.93, marge: 0, categorie: 'bebe' },
        { reference: 'BE007', description: 'Doudou ours Barney (m) 160mm', prixHT: 5.48, tauxTVA: 0, coutAchat: 5.48, marge: 0, categorie: 'bebe' },
        { reference: 'BE008', description: 'Doudou Lapin xxl 500mm', prixHT: 34.44, tauxTVA: 0, coutAchat: 34.44, marge: 0, categorie: 'bebe' },
        { reference: 'BE009', description: 'Doudou Lapin (m)', prixHT: 5.48, tauxTVA: 0, coutAchat: 5.48, marge: 0, categorie: 'bebe' },
        // SERVIETTES - SE001 à SE002
        { reference: 'SE001', description: 'Serviette de bain 50x100', prixHT: 6.40, tauxTVA: 0, coutAchat: 6.40, marge: 0, categorie: 'serviettes' },
        { reference: 'SE002', description: 'Serviette de bain 70x141', prixHT: 11.95, tauxTVA: 0, coutAchat: 11.95, marge: 0, categorie: 'serviettes' },
    ],
    factures: [
        { numero: 'F00001', clientId: 'C00002', date: '2024-10-23', dateEcheance: '2024-11-22', modeReglement: 'espèces', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'T002', description: 'Tasse émail 450 ml personnalisée', prixHT: 15.0, quantite: 1, tauxTVA: 0 }], totalHT: 15.0, totalTTC: 15.0 },
        { numero: 'F00002', clientId: 'C00002', date: '2024-10-27', dateEcheance: '2024-11-26', modeReglement: 'espèces', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'T002', description: 'Tasse émail 450 ml personnalisée', prixHT: 15.0, quantite: 2, tauxTVA: 0 }], totalHT: 30.0, totalTTC: 30.0 },
        { numero: 'F00003', clientId: 'C00003', date: '2024-11-15', dateEcheance: '2024-12-15', modeReglement: 'espèces', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'T015', description: 'Tasse paillette rose bleu', prixHT: 15.0, quantite: 9, tauxTVA: 0 }], totalHT: 135.0, totalTTC: 135.0 },
        { numero: 'F00004', clientId: 'C00004', date: '2024-11-24', dateEcheance: '2024-12-24', modeReglement: 'espèces', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'T015', description: 'Tasse paillette rose bleu', prixHT: 15.0, quantite: 4, tauxTVA: 0 }], totalHT: 60.0, totalTTC: 60.0 },
        { numero: 'F00005', clientId: 'C00005', date: '2024-11-24', dateEcheance: '2024-12-24', modeReglement: 'espèces', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'T015', description: 'Tasse paillette rose bleu', prixHT: 15.0, quantite: 4, tauxTVA: 0 }, { id: 2, reference: 'A006', description: 'Ardoise cœur', prixHT: 20.0, quantite: 4, tauxTVA: 0 }], totalHT: 140.0, totalTTC: 140.0 },
        { numero: 'F00006', clientId: 'C00006', date: '2024-12-04', dateEcheance: '2025-01-03', modeReglement: 'paypal', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'V001', description: 'Verre cannette avec paille givré', prixHT: 20.0, quantite: 1, tauxTVA: 0 }], totalHT: 20.0, totalTTC: 20.0 },
        { numero: 'F00007', clientId: 'C00007', date: '2024-12-04', dateEcheance: '2025-01-03', modeReglement: 'espèces', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'T006', description: 'Tasse Waouh', prixHT: 15.0, quantite: 2, tauxTVA: 0 }, { id: 2, reference: 'T008', description: 'Tasse en verre jaune', prixHT: 15.0, quantite: 1, tauxTVA: 0 }, { id: 3, reference: 'G006', description: 'Gourde sport Alu Blanc 500ML', prixHT: 13.0, quantite: 1, tauxTVA: 0 }], totalHT: 58.0, totalTTC: 58.0 },
        { numero: 'F00008', clientId: 'C00008', date: '2024-12-04', dateEcheance: '2025-01-03', modeReglement: 'CB', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'G004', description: 'Gourde Iso inox 500ML bleu/vert', prixHT: 18.0, quantite: 1, tauxTVA: 0 }], totalHT: 18.0, totalTTC: 18.0 },
        { numero: 'F00009', clientId: 'C00010', date: '2024-12-04', dateEcheance: '2025-01-03', modeReglement: 'CB', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'T008', description: 'Tasse en verre jaune', prixHT: 15.0, quantite: 1, tauxTVA: 0 }], totalHT: 15.0, totalTTC: 15.0 },
        { numero: 'F00010', clientId: 'C00011', date: '2024-12-05', dateEcheance: '2025-01-04', modeReglement: 'à définir', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'T014', description: 'Tasse paillette rose jaune', prixHT: 15.0, quantite: 3, tauxTVA: 0 }, { id: 2, reference: 'A007', description: 'Ardoise croix', prixHT: 20.0, quantite: 1, tauxTVA: 0 }, { id: 3, reference: 'BO003', description: 'Boîte à gouter Vert', prixHT: 15.0, quantite: 1, tauxTVA: 0 }, { id: 4, reference: 'BO004', description: 'Boîte à gouter Rose', prixHT: 15.0, quantite: 1, tauxTVA: 0 }], totalHT: 95.0, totalTTC: 95.0 },
        { numero: 'F00011', clientId: 'C00001', date: '2024-12-07', dateEcheance: '2025-01-06', modeReglement: 'CB', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'T008', description: 'Tasse en verre jaune', prixHT: 15.0, quantite: 1, tauxTVA: 0 }], totalHT: 15.0, totalTTC: 15.0 },
        { numero: 'F00012', clientId: 'C00001', date: '2024-12-07', dateEcheance: '2025-01-06', modeReglement: 'CB', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'G005', description: 'Gourde sport Alu Gris 500ML', prixHT: 13.0, quantite: 2, tauxTVA: 0 }], totalHT: 26.0, totalTTC: 26.0 },
        { numero: 'F00013', clientId: 'C00012', date: '2024-12-19', dateEcheance: '2025-01-18', modeReglement: 'CB', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'T015', description: 'Tasse paillette rose bleu', prixHT: 15.0, quantite: 3, tauxTVA: 0 }, { id: 2, reference: 'BO004', description: 'Boîte à gouter Rose', prixHT: 15.0, quantite: 3, tauxTVA: 0 }], totalHT: 90.0, totalTTC: 90.0 },
        { numero: 'F00014', clientId: 'C00013', date: '2025-02-27', dateEcheance: '2025-03-29', modeReglement: 'virement', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'T007', description: 'Tasse noir int blanc', prixHT: 0.0, quantite: 1, tauxTVA: 0 }], totalHT: 0.0, totalTTC: 0.0 },
        { numero: 'F00015', clientId: 'C00015', date: '2025-02-27', dateEcheance: '2025-03-29', modeReglement: 'espèces', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'T007', description: 'Tasse noir int blanc', prixHT: 0.0, quantite: 1, tauxTVA: 0 }], totalHT: 0.0, totalTTC: 0.0 },
        { numero: 'F00016', clientId: 'C00016', date: '2025-02-27', dateEcheance: '2025-03-29', modeReglement: 'espèces', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'T007', description: 'Tasse noir int blanc', prixHT: 0.0, quantite: 1, tauxTVA: 0 }, { id: 2, reference: 'T008', description: 'Tasse en verre jaune', prixHT: 15.0, quantite: 2, tauxTVA: 0 }], totalHT: 30.0, totalTTC: 30.0 },
        { numero: 'F00017', clientId: 'C00014', date: '2025-02-27', dateEcheance: '2025-03-29', modeReglement: 'virement', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'T007', description: 'Tasse noir int blanc', prixHT: 0.0, quantite: 1, tauxTVA: 0 }], totalHT: 0.0, totalTTC: 0.0 },
        { numero: 'F00018', clientId: 'C00017', date: '2025-03-30', dateEcheance: '2025-04-29', modeReglement: 'paypal', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'PA001', description: 'Panneau acrylique 100 x 150', prixHT: 8.0, quantite: 1, tauxTVA: 0 }, { id: 2, reference: 'PA002', description: 'Panneau acrylique 150 x 200', prixHT: 10.0, quantite: 1, tauxTVA: 0 }], totalHT: 18.0, totalTTC: 18.0 },
        { numero: 'F00019', clientId: 'C00001', date: '2025-04-20', dateEcheance: '2025-05-20', modeReglement: 'à définir', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'T002', description: 'Tasse émail 450 ml personnalisée', prixHT: 15.0, quantite: 1, tauxTVA: 0 }], totalHT: 15.0, totalTTC: 15.0 },
        { numero: 'F00020', clientId: 'C00017', date: '2025-04-25', dateEcheance: '2025-05-25', modeReglement: 'paypal', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'PA001', description: 'Panneau acrylique 100 x 150', prixHT: 8.0, quantite: 9, tauxTVA: 0 }, { id: 2, reference: 'PA002', description: 'Panneau acrylique 150 x 200', prixHT: 10.0, quantite: 10, tauxTVA: 0 }, { id: 3, reference: 'PA005', description: 'Panneau acrylique 200 x 300', prixHT: 22.0, quantite: 3, tauxTVA: 0 }], totalHT: 238.0, totalTTC: 238.0 },
        { numero: 'F00021', clientId: 'C00019', date: '2025-05-20', dateEcheance: '2025-06-19', modeReglement: 'espèces', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'T007', description: 'Tasse noir int blanc', prixHT: 0.0, quantite: 1, tauxTVA: 0 }], totalHT: 0.0, totalTTC: 0.0 },
        { numero: 'F00022', clientId: 'C00016', date: '2025-06-24', dateEcheance: '2025-07-24', modeReglement: 'à définir', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'PA006', description: 'Panneau acrylique 100 x 200', prixHT: 8.5, quantite: 1, tauxTVA: 0 }], totalHT: 8.5, totalTTC: 8.5 },
        { numero: 'F00023', clientId: 'C00020', date: '2025-07-03', dateEcheance: '2025-08-02', modeReglement: 'à définir', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'PA006', description: 'Panneau acrylique 100 x 200', prixHT: 8.5, quantite: 65, tauxTVA: 0 }], totalHT: 552.5, totalTTC: 552.5 },
        { numero: 'F00024', clientId: 'C00021', date: '2025-08-30', dateEcheance: '2025-09-29', modeReglement: 'espèces', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'G010', description: 'Thermos Inox 750ML Gris+Gobelet', prixHT: 22.0, quantite: 1, tauxTVA: 0 }], totalHT: 22.0, totalTTC: 22.0 },
        { numero: 'F00025', clientId: 'C00022', date: '2026-01-20', dateEcheance: '2026-01-20', modeReglement: 'virement', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'PA009', description: 'Panneau en verre 127 x 178', prixHT: 15.0, quantite: 16, tauxTVA: 0 }], totalHT: 240.0, totalTTC: 240.0 },
        { numero: 'F00026', clientId: 'C00023', date: '2025-09-23', dateEcheance: '2025-10-23', modeReglement: 'espèces', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'PA002', description: 'Panneau acrylique 150 x 200', prixHT: 10.0, quantite: 2, tauxTVA: 0 }], totalHT: 20.0, totalTTC: 20.0 },
        { numero: 'F00027', clientId: 'C00001', date: '2026-01-20', dateEcheance: '2026-01-20', modeReglement: 'espèces', remise: 0, acompte: 0, lignes: [{ id: 1, reference: 'G006', description: 'Gourde sport Alu Blanc 500ML', prixHT: 13.0, quantite: 1, tauxTVA: 0 }, { id: 2, reference: 'G011', description: 'Thermos Inox 750ML Blanc+Gobelet', prixHT: 22.0, quantite: 1, tauxTVA: 0 }], totalHT: 35.0, totalTTC: 35.0 },
    ],
    devis: [],
    paiements: [],
    relances: [], // Historique des relances envoyées
    referencesMigrated: true // Flag pour migration des références
};

// ============================================
// VARIABLES GLOBALES
// ============================================
let data = {};
let currentTab = 'dashboard';
let currentFacture = null;
let caYear = new Date().getFullYear();
let isAdminMode = false;

// ============================================
// FONCTIONS UTILITAIRES
// ============================================
let firebaseReady = false;

function loadData() {
    // Charger d'abord depuis localStorage (fallback immédiat)
    const saved = localStorage.getItem('facturier_stylemoi_v3');
    if (saved) {
        try {
            data = JSON.parse(saved);
            applyDataMigrations();
        } catch (e) {
            data = JSON.parse(JSON.stringify(defaultData));
        }
    } else {
        data = JSON.parse(JSON.stringify(defaultData));
    }
    
    // Activer le listener Firebase temps réel
    if (dbRef) {
        dbRef.on('value', (snapshot) => {
            const firebaseData = snapshot.val();
            if (firebaseData) {
                data = firebaseData;
                applyDataMigrations();
                localStorage.setItem('facturier_stylemoi_v3', JSON.stringify(data));
                if (firebaseReady) {
                    // Rafraîchir l'affichage si changement externe
                    renderPage();
                    updateSidebarLogo();
                }
                console.log('🔄 Données synchronisées depuis Firebase');
            } else if (!firebaseReady) {
                // Premier chargement, Firebase vide -> envoyer les données locales
                if (data.factures && data.factures.length > 0) {
                    dbRef.set(data);
                    console.log('📤 Données locales envoyées vers Firebase');
                }
            }
            firebaseReady = true;
        }, (error) => {
            console.error('❌ Erreur Firebase:', error);
            firebaseReady = true;
        });
    }
}

function applyDataMigrations() {
    // Migration des anciennes données
    if (!data.tauxURSSAFParMois) data.tauxURSSAFParMois = { 'default': 23.20 };
    if (!data.relances) data.relances = [];
    if (!data.cgv) data.cgv = defaultData.cgv;
    if (!data.logo) data.logo = null;
    if (!data.version) data.version = '3.2.0';
    if (!data.adminPassword) data.adminPassword = 'admin123';
    if (!data.categories) data.categories = defaultData.categories;
    // Migration des produits sans catégorie
    if (data.produits) {
        data.produits.forEach(p => {
            if (!p.categorie) {
                const desc = p.description.toLowerCase();
                if (desc.includes('tasse') || desc.includes('mug') || desc.includes('choppe') || desc.includes('bol')) {
                    p.categorie = 'tasses';
                } else if (desc.includes('gourde') || desc.includes('bouteille') || desc.includes('thermos') || desc.includes('cannette') || desc.includes('gobelet')) {
                    p.categorie = 'gourdes';
                } else if (desc.includes('verre cannette') || desc.includes('verre avec paille')) {
                    p.categorie = 'verres';
                } else if (desc.includes('ardoise')) {
                    p.categorie = 'ardoises';
                } else if (desc.includes('panneau') || desc.includes('plaque photo')) {
                    p.categorie = 'panneaux';
                } else if (desc.includes('planche') || desc.includes('gant') || desc.includes('manique') || desc.includes('carrelage')) {
                    p.categorie = 'cuisine';
                } else if (desc.includes('tablier')) {
                    p.categorie = 'tabliers';
                } else if (desc.includes('boîte') || desc.includes('boite')) {
                    p.categorie = 'boites';
                } else if (desc.includes('coussin') || desc.includes('bouillotte')) {
                    p.categorie = 'coussins';
                } else if (desc.includes('tshirt') || desc.includes('t-shirt')) {
                    p.categorie = 'tshirts';
                } else if (desc.includes('body') || desc.includes('bavoir') || desc.includes('doudou')) {
                    p.categorie = 'bebe';
                } else if (desc.includes('serviette')) {
                    p.categorie = 'serviettes';
                } else {
                    p.categorie = 'accessoires';
                }
            }
        });
    }
    // Migration des références produits par catégorie (une seule fois)
    if (!data.referencesMigrated) {
        migrateProductReferences();
        data.referencesMigrated = true;
    }
}

function saveData() {
    localStorage.setItem('facturier_stylemoi_v3', JSON.stringify(data));
    // Sync Firebase Realtime Database
    if (dbRef) {
        dbRef.set(data).catch(e => console.error('❌ Erreur sync Firebase:', e));
    }
}

function migrateProductReferences() {
    // Table de correspondance catégorie -> préfixe
    const prefixes = {
        'tasses': 'T',
        'gourdes': 'G',
        'verres': 'V',
        'ardoises': 'A',
        'panneaux': 'PA',
        'cuisine': 'CU',
        'tabliers': 'TA',
        'boites': 'BO',
        'accessoires': 'AC',
        'coussins': 'CO',
        'tshirts': 'TS',
        'bebe': 'BE',
        'serviettes': 'SE',
        'divers': 'D'
    };
    
    // Compteurs par catégorie
    const compteurs = {};
    Object.keys(prefixes).forEach(cat => compteurs[cat] = 0);
    
    // Mapping anciennes références -> nouvelles
    const refMapping = {};
    
    // Renommer tous les produits
    data.produits.forEach(p => {
        const oldRef = p.reference;
        const catId = p.categorie || 'divers';
        const prefix = prefixes[catId] || 'X';
        
        compteurs[catId] = (compteurs[catId] || 0) + 1;
        const newRef = `${prefix}${String(compteurs[catId]).padStart(3, '0')}`;
        
        refMapping[oldRef] = newRef;
        p.reference = newRef;
    });
    
    // Mettre à jour les factures
    if (data.factures) {
        data.factures.forEach(f => {
            if (f.lignes) {
                f.lignes.forEach(l => {
                    if (refMapping[l.reference]) {
                        l.reference = refMapping[l.reference];
                    }
                });
            }
        });
    }
    
    // Mettre à jour les devis
    if (data.devis) {
        data.devis.forEach(d => {
            if (d.lignes) {
                d.lignes.forEach(l => {
                    if (refMapping[l.reference]) {
                        l.reference = refMapping[l.reference];
                    }
                });
            }
        });
    }
    
    console.log('Migration des références effectuée:', refMapping);
}

function generateNumber(prefix, items) {
    const nums = items.map(i => parseInt(i.numero?.replace(prefix, '') || '0')).filter(n => !isNaN(n));
    const max = nums.length > 0 ? Math.max(...nums) : 0;
    return `${prefix}${String(max + 1).padStart(5, '0')}`;
}

function generateProductReference(categorieId) {
    // Table de correspondance catégorie -> préfixe
    const prefixes = {
        'tasses': 'T',
        'gourdes': 'G',
        'verres': 'V',
        'ardoises': 'A',
        'panneaux': 'PA',
        'cuisine': 'CU',
        'tabliers': 'TA',
        'boites': 'BO',
        'accessoires': 'AC',
        'coussins': 'CO',
        'tshirts': 'TS',
        'bebe': 'BE',
        'serviettes': 'SE',
        'divers': 'D'
    };
    
    const prefixe = prefixes[categorieId] || 'X';
    
    // Trouver le numéro max pour cette catégorie
    const produitsCategorie = data.produits.filter(p => p.categorie === categorieId);
    const regex = new RegExp(`^${prefixe}(\\d+)$`);
    const nums = produitsCategorie
        .map(p => {
            const match = p.reference.match(regex);
            return match ? parseInt(match[1]) : 0;
        })
        .filter(n => !isNaN(n));
    
    const max = nums.length > 0 ? Math.max(...nums) : 0;
    return `${prefixe}${String(max + 1).padStart(3, '0')}`;
}

function formatDate(dateStr) {
    if (!dateStr) return '-';
    return new Date(dateStr).toLocaleDateString('fr-FR');
}

function formatMoney(amount) {
    return (amount || 0).toFixed(2) + ' €';
}

function getClientName(facture) {
    if (facture.paiementComptoir) return '🛒 Paiement comptoir';
    const client = getClient(facture.clientId);
    return client?.nom || '-';
}

function getClient(id) {
    return data.clients.find(c => c.numero === id);
}

function getTauxURSSAF(yearMonth) {
    return data.tauxURSSAFParMois[yearMonth] !== undefined 
        ? data.tauxURSSAFParMois[yearMonth] 
        : (data.tauxURSSAFParMois['default'] || 23.20);
}

function setTauxURSSAF(yearMonth, taux) {
    data.tauxURSSAFParMois[yearMonth] = taux;
    saveData();
}

// ============================================
// NAVIGATION
// ============================================
const menuItems = [
    { id: 'dashboard', icon: '📊', label: 'Tableau de bord' },
    { id: 'clients', icon: '👥', label: 'Clients' },
    { id: 'produits', icon: '📦', label: 'Produits' },
    { id: 'devis', icon: '📝', label: 'Devis' },
    { id: 'factures', icon: '🧾', label: 'Factures' },
    { id: 'paiements', icon: '💳', label: 'Suivi paiements' },
    { id: 'relances', icon: '📬', label: 'Lettres de relance' },
    { id: 'ca', icon: '💰', label: "Chiffre d'affaires" },
    { id: 'settings', icon: '⚙️', label: 'Paramètres' },
    { id: 'logout', icon: '🚪', label: 'Déconnexion' },
];

function renderNav() {
    const nav = document.getElementById('nav-menu');
    nav.innerHTML = menuItems.map(item => `
        <button onclick="navigateTo('${item.id}')" 
            class="sidebar-item w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${currentTab === item.id ? 'active text-white shadow-lg' : 'text-stone-300 hover:bg-stone-700/50'}">
            <span class="text-xl">${item.icon}</span>
            <span class="font-medium">${item.label}</span>
        </button>
    `).join('');
    
    // Mise à jour du logo dans la sidebar
    updateSidebarLogo();
}

function updateSidebarLogo() {
    const logoContainer = document.getElementById('sidebar-logo');
    if (data.logo) {
        logoContainer.innerHTML = `<img src="${data.logo}" alt="Logo" class="max-h-16">`;
    } else {
        logoContainer.innerHTML = `<h1 class="text-2xl font-bold bg-gradient-to-r from-amber-400 to-orange-400 bg-clip-text text-transparent">${data.entreprise.nom}</h1>`;
    }
    document.getElementById('version-display').textContent = 'v' + data.version;
}

function navigateTo(tab) {
    if (tab === 'logout') {
        logout();
        return;
    }
    if (tab === 'settings') {
        // Demander le mot de passe admin pour accéder aux paramètres
        askAdminPassword(() => {
            currentTab = tab;
            renderNav();
            renderPage();
        });
    } else {
        currentTab = tab;
        renderNav();
        renderPage();
    }
}

function askAdminPassword(callback) {
    const content = `
        <div class="space-y-4">
            <p class="text-stone-600">🔐 Cette section est protégée. Entrez le mot de passe administrateur.</p>
            <div>
                <label class="block text-sm font-medium text-stone-600 mb-1">Mot de passe</label>
                <input type="password" id="admin-access-password" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl" placeholder="Mot de passe..." onkeypress="if(event.key==='Enter')checkAdminAccess()">
            </div>
        </div>
        <div class="flex justify-end gap-3 mt-6">
            <button onclick="closeModal()" class="px-4 py-2.5 bg-stone-100 text-stone-700 rounded-xl font-medium">Annuler</button>
            <button onclick="checkAdminAccess()" class="btn-primary text-white px-4 py-2.5 rounded-xl font-medium">Accéder</button>
        </div>
    `;
    window.adminCallback = callback;
    showModal('🔒 Accès Paramètres', content, 'max-w-md');
    setTimeout(() => document.getElementById('admin-access-password')?.focus(), 100);
}

function checkAdminAccess() {
    const password = document.getElementById('admin-access-password').value;
    if (password === data.adminPassword) {
        closeModal();
        if (window.adminCallback) {
            window.adminCallback();
            window.adminCallback = null;
        }
    } else {
        alert('❌ Mot de passe incorrect !');
    }
}

// ============================================
// MODAL
// ============================================
function showModal(title, content, size = 'max-w-4xl') {
    const container = document.getElementById('modal-container');
    const modalContent = document.getElementById('modal-content');
    modalContent.className = `bg-white rounded-2xl shadow-2xl w-full ${size} max-h-[90vh] overflow-hidden`;
    modalContent.innerHTML = `
        <div class="flex items-center justify-between px-6 py-4 border-b border-stone-200 bg-gradient-to-r from-amber-50 to-orange-50">
            <h2 class="text-xl font-semibold text-stone-800">${title}</h2>
            <button onclick="closeModal()" class="p-2 hover:bg-stone-200 rounded-full transition-colors text-xl">✕</button>
        </div>
        <div class="p-6 overflow-y-auto max-h-[calc(90vh-80px)]">${content}</div>
    `;
    container.classList.remove('hidden');
}

function closeModal() {
    document.getElementById('modal-container').classList.add('hidden');
}

// ============================================
// DASHBOARD
// ============================================
function renderDashboard() {
    const today = new Date();
    const thisMonth = data.factures.filter(f => {
        const d = new Date(f.date);
        return d.getMonth() === today.getMonth() && d.getFullYear() === today.getFullYear();
    });
    const caThisMonth = thisMonth.reduce((sum, f) => sum + (f.totalHT || 0), 0);
    const facturesNonPayees = data.factures.filter(f => !data.paiements?.find(p => p.numero === f.numero)?.paye);
    const totalImpaye = facturesNonPayees.reduce((sum, f) => sum + (f.totalTTC || 0), 0);
    
    // Factures en retard (échéance dépassée)
    const facturesEnRetard = facturesNonPayees.filter(f => new Date(f.dateEcheance) < today);

    return `
        <div class="space-y-6">
            <div>
                <h2 class="text-2xl font-bold text-stone-800">Bonjour ! 👋</h2>
                <p class="text-stone-500">${today.toLocaleDateString('fr-FR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
            </div>
            <div class="grid grid-cols-4 gap-4">
                <div class="bg-gradient-to-br from-amber-500 to-orange-500 text-white rounded-2xl p-6 shadow-lg">
                    <div class="flex items-center gap-3 mb-2"><span class="text-3xl">💰</span><span class="text-amber-100">CA ce mois</span></div>
                    <p class="text-3xl font-bold">${formatMoney(caThisMonth)}</p>
                    <p class="text-amber-100 text-sm mt-1">${thisMonth.length} facture(s)</p>
                </div>
                <div class="bg-white rounded-2xl p-6 border border-stone-200 shadow-sm">
                    <div class="flex items-center gap-3 mb-2"><span class="text-3xl">🧾</span><span class="text-stone-500">Factures</span></div>
                    <p class="text-3xl font-bold text-stone-800">${data.factures.length}</p>
                    <p class="text-stone-500 text-sm mt-1">Total créées</p>
                </div>
                <div class="bg-white rounded-2xl p-6 border border-stone-200 shadow-sm">
                    <div class="flex items-center gap-3 mb-2"><span class="text-3xl">👥</span><span class="text-stone-500">Clients</span></div>
                    <p class="text-3xl font-bold text-stone-800">${data.clients.length}</p>
                    <p class="text-stone-500 text-sm mt-1">Enregistrés</p>
                </div>
                <div class="${totalImpaye > 0 ? 'bg-red-50 border-red-200' : 'bg-emerald-50 border-emerald-200'} rounded-2xl p-6 border shadow-sm">
                    <div class="flex items-center gap-3 mb-2"><span class="text-3xl">⚠️</span><span class="${totalImpaye > 0 ? 'text-red-600' : 'text-emerald-600'}">À encaisser</span></div>
                    <p class="text-3xl font-bold ${totalImpaye > 0 ? 'text-red-700' : 'text-emerald-700'}">${formatMoney(totalImpaye)}</p>
                    <p class="text-sm mt-1 ${totalImpaye > 0 ? 'text-red-500' : 'text-emerald-500'}">${facturesNonPayees.length} facture(s)</p>
                </div>
            </div>
            
            ${facturesEnRetard.length > 0 ? `
            <div class="bg-red-50 border border-red-200 rounded-xl p-4">
                <h3 class="font-semibold text-red-800 mb-2">⚠️ ${facturesEnRetard.length} facture(s) en retard de paiement</h3>
                <div class="space-y-2">
                    ${facturesEnRetard.slice(0, 3).map(f => `
                        <div class="flex justify-between items-center bg-white rounded-lg p-3">
                            <div>
                                <span class="font-medium">${f.numero}</span> - ${getClientName(f)}
                            </div>
                            <div class="flex items-center gap-3">
                                <span class="text-red-600 font-medium">${formatMoney(f.totalTTC)}</span>
                                <button onclick="navigateTo('relances')" class="text-sm bg-red-500 text-white px-3 py-1 rounded-lg">Relancer</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
                ${facturesEnRetard.length > 3 ? `<p class="text-sm text-red-600 mt-2">Et ${facturesEnRetard.length - 3} autre(s)...</p>` : ''}
            </div>
            ` : ''}
            
            <div class="grid grid-cols-2 gap-6">
                <div class="bg-white rounded-2xl p-6 border border-stone-200 shadow-sm">
                    <h3 class="font-semibold text-stone-800 mb-4">Dernières factures</h3>
                    <div class="space-y-3">
                        ${data.factures.slice(-5).reverse().map(f => `
                            <div class="flex items-center justify-between py-2 border-b border-stone-100 last:border-0">
                                <div><p class="font-medium">${f.numero}</p><p class="text-sm text-stone-500">${getClientName(f)}</p></div>
                                <div class="text-right"><p class="font-medium">${formatMoney(f.totalTTC)}</p><p class="text-sm text-stone-500">${formatDate(f.date)}</p></div>
                            </div>
                        `).join('') || '<p class="text-stone-400 text-center py-4">Aucune facture</p>'}
                    </div>
                </div>
                <div class="bg-white rounded-2xl p-6 border border-stone-200 shadow-sm">
                    <h3 class="font-semibold text-stone-800 mb-4">Produits populaires</h3>
                    <div class="space-y-3">
                        ${data.produits.filter(p => p.prixHT > 0).slice(0, 6).map(p => `
                            <div class="flex items-center justify-between py-2 border-b border-stone-100 last:border-0">
                                <div><p class="font-medium">${p.description}</p><p class="text-sm text-stone-500">${p.reference}</p></div>
                                <p class="font-medium text-amber-600">${formatMoney(p.prixHT)}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        </div>
    `;
}

// ============================================
// CLIENTS
// ============================================
let clientSearch = '';

function renderClients() {
    const filtered = data.clients.filter(c => 
        c.nom.toLowerCase().includes(clientSearch.toLowerCase()) || 
        c.numero.toLowerCase().includes(clientSearch.toLowerCase())
    );

    return `
        <div class="space-y-6">
            <div class="flex items-center justify-between">
                <h2 class="text-2xl font-bold text-stone-800">Base Clients (${data.clients.length})</h2>
                <button onclick="openClientModal()" class="btn-primary text-white px-4 py-2.5 rounded-xl font-medium flex items-center gap-2">
                    <span>+</span> Nouveau client
                </button>
            </div>
            <div class="relative">
                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-stone-400">🔍</span>
                <input type="text" placeholder="Rechercher un client..." value="${clientSearch}" 
                    oninput="clientSearch = this.value; renderPage()"
                    class="w-full pl-12 pr-4 py-3 border border-stone-300 rounded-xl focus:ring-2 focus:ring-amber-400 focus:outline-none">
            </div>
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-stone-200">
                <table class="w-full">
                    <thead class="bg-gradient-to-r from-stone-100 to-stone-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-stone-600">N° Client</th>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-stone-600">Type</th>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-stone-600">Nom</th>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-stone-600">Ville</th>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-stone-600">Email</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold text-stone-600">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-stone-100">
                        ${filtered.map(c => `
                            <tr class="hover:bg-amber-50/50 transition-colors">
                                <td class="px-4 py-3 text-sm">${c.numero}</td>
                                <td class="px-4 py-3"><span class="px-2 py-1 rounded-full text-xs font-medium ${c.type === 'Professionnel' ? 'bg-blue-100 text-blue-700' : 'bg-green-100 text-green-700'}">${c.type}</span></td>
                                <td class="px-4 py-3 text-sm font-medium">${c.nom}</td>
                                <td class="px-4 py-3 text-sm">${c.ville || '-'}</td>
                                <td class="px-4 py-3 text-sm">${c.email || '-'}</td>
                                <td class="px-4 py-3 text-right">
                                    <button onclick="openClientModal('${c.numero}')" class="p-1.5 text-amber-500 hover:bg-amber-50 rounded-lg" title="Modifier">✏️</button>
                                    <button onclick="deleteClient('${c.numero}')" class="p-1.5 text-red-500 hover:bg-red-50 rounded-lg" title="Supprimer">🗑️</button>
                                </td>
                            </tr>
                        `).join('') || '<tr><td colspan="6" class="px-4 py-8 text-center text-stone-400">Aucun client</td></tr>'}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function openClientModal(numero = null) {
    const client = numero ? data.clients.find(c => c.numero === numero) : {
        numero: generateNumber('C', data.clients),
        type: 'Particulier', nom: '', adresse: '', codePostal: '', ville: '',
        telephone: '', portable: '', email: ''
    };
    const isEdit = !!numero;

    const content = `
        <div class="grid grid-cols-2 gap-4">
            <div><label class="block text-sm font-medium text-stone-600 mb-1">N° Client</label>
                <input type="text" id="client-numero" value="${client.numero}" disabled class="w-full px-4 py-2.5 border border-stone-300 rounded-xl bg-stone-100"></div>
            <div><label class="block text-sm font-medium text-stone-600 mb-1">Type</label>
                <select id="client-type" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl">
                    <option value="Particulier" ${client.type === 'Particulier' ? 'selected' : ''}>Particulier</option>
                    <option value="Professionnel" ${client.type === 'Professionnel' ? 'selected' : ''}>Professionnel</option>
                </select></div>
            <div class="col-span-2"><label class="block text-sm font-medium text-stone-600 mb-1">Nom / Raison sociale</label>
                <input type="text" id="client-nom" value="${client.nom}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
            <div class="col-span-2"><label class="block text-sm font-medium text-stone-600 mb-1">Adresse</label>
                <input type="text" id="client-adresse" value="${client.adresse || ''}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
            <div><label class="block text-sm font-medium text-stone-600 mb-1">Code postal</label>
                <input type="text" id="client-cp" value="${client.codePostal || ''}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
            <div><label class="block text-sm font-medium text-stone-600 mb-1">Ville</label>
                <input type="text" id="client-ville" value="${client.ville || ''}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
            <div><label class="block text-sm font-medium text-stone-600 mb-1">Téléphone</label>
                <input type="text" id="client-tel" value="${client.telephone || ''}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
            <div><label class="block text-sm font-medium text-stone-600 mb-1">Portable</label>
                <input type="text" id="client-portable" value="${client.portable || ''}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
            <div class="col-span-2"><label class="block text-sm font-medium text-stone-600 mb-1">Email</label>
                <input type="email" id="client-email" value="${client.email || ''}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
        </div>
        <div class="flex justify-end gap-3 mt-6">
            <button onclick="closeModal()" class="px-4 py-2.5 bg-stone-100 text-stone-700 rounded-xl font-medium">Annuler</button>
            <button onclick="saveClient('${numero || ''}')" class="btn-primary text-white px-4 py-2.5 rounded-xl font-medium">${isEdit ? 'Enregistrer' : 'Créer'}</button>
        </div>
    `;
    showModal(isEdit ? 'Modifier client' : 'Nouveau client', content, 'max-w-2xl');
}

function saveClient(oldNumero) {
    const client = {
        numero: document.getElementById('client-numero').value,
        type: document.getElementById('client-type').value,
        nom: document.getElementById('client-nom').value,
        adresse: document.getElementById('client-adresse').value,
        codePostal: document.getElementById('client-cp').value,
        ville: document.getElementById('client-ville').value,
        telephone: document.getElementById('client-tel').value,
        portable: document.getElementById('client-portable').value,
        email: document.getElementById('client-email').value
    };

    if (oldNumero) {
        const idx = data.clients.findIndex(c => c.numero === oldNumero);
        if (idx !== -1) data.clients[idx] = client;
    } else {
        data.clients.push(client);
    }

    saveData();
    closeModal();
    renderPage();
}

function deleteClient(numero) {
    if (confirm('Supprimer ce client ?')) {
        data.clients = data.clients.filter(c => c.numero !== numero);
        saveData();
        renderPage();
    }
}

// ============================================
// PRODUITS
// ============================================
let produitSearch = '';
let selectedCategorie = null; // null = toutes les catégories

function renderProduits() {
    // Filtrer par catégorie et recherche
    let filtered = data.produits;
    if (selectedCategorie) {
        filtered = filtered.filter(p => p.categorie === selectedCategorie);
    }
    if (produitSearch) {
        filtered = filtered.filter(p => 
            p.description.toLowerCase().includes(produitSearch.toLowerCase()) || 
            p.reference.toLowerCase().includes(produitSearch.toLowerCase())
        );
    }

    // Grouper par catégorie pour l'affichage
    const produitsParCategorie = {};
    data.categories.forEach(cat => {
        produitsParCategorie[cat.id] = filtered.filter(p => p.categorie === cat.id);
    });
    // Produits sans catégorie
    const sansCat = filtered.filter(p => !p.categorie || !data.categories.find(c => c.id === p.categorie));
    if (sansCat.length > 0) {
        produitsParCategorie['_autres'] = sansCat;
    }

    return `
        <div class="space-y-6">
            <div class="flex items-center justify-between">
                <h2 class="text-2xl font-bold text-stone-800">Base Produits (${data.produits.length})</h2>
                <div class="flex gap-2">
                    <button onclick="openCategorieModal()" class="px-4 py-2.5 bg-stone-100 text-stone-700 rounded-xl font-medium hover:bg-stone-200 flex items-center gap-2">
                        <span>📁</span> Gérer catégories
                    </button>
                    <button onclick="openProduitModal()" class="btn-primary text-white px-4 py-2.5 rounded-xl font-medium flex items-center gap-2">
                        <span>+</span> Nouveau produit
                    </button>
                </div>
            </div>

            <!-- Filtres par catégorie -->
            <div class="flex flex-wrap gap-2">
                <button onclick="selectedCategorie = null; renderPage()" 
                    class="px-4 py-2 rounded-xl font-medium transition-all ${!selectedCategorie ? 'bg-gradient-to-r from-amber-500 to-orange-500 text-white shadow-lg' : 'bg-white text-stone-600 border border-stone-200 hover:bg-stone-50'}">
                    Tous (${data.produits.length})
                </button>
                ${data.categories.map(cat => {
                    const count = data.produits.filter(p => p.categorie === cat.id).length;
                    return `
                        <button onclick="selectedCategorie = '${cat.id}'; renderPage()" 
                            class="px-4 py-2 rounded-xl font-medium transition-all flex items-center gap-2 ${selectedCategorie === cat.id ? 'bg-gradient-to-r from-amber-500 to-orange-500 text-white shadow-lg' : 'bg-white text-stone-600 border border-stone-200 hover:bg-stone-50'}">
                            <span>${cat.icon}</span> ${cat.nom} (${count})
                        </button>
                    `;
                }).join('')}
            </div>

            <!-- Barre de recherche -->
            <div class="relative">
                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-stone-400">🔍</span>
                <input type="text" placeholder="Rechercher un produit..." value="${produitSearch}" 
                    oninput="produitSearch = this.value; renderPage()"
                    class="w-full pl-12 pr-4 py-3 border border-stone-300 rounded-xl focus:ring-2 focus:ring-amber-400 focus:outline-none">
            </div>

            <!-- Affichage par catégorie ou liste simple -->
            ${selectedCategorie ? renderProduitsTable(filtered) : renderProduitsParCategorie(produitsParCategorie)}
        </div>
    `;
}

function renderProduitsTable(produits) {
    return `
        <div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-stone-200">
            <table class="w-full">
                <thead class="bg-gradient-to-r from-stone-100 to-stone-50">
                    <tr>
                        <th class="px-4 py-3 text-left text-sm font-semibold text-stone-600">Réf.</th>
                        <th class="px-4 py-3 text-left text-sm font-semibold text-stone-600">Description</th>
                        <th class="px-4 py-3 text-right text-sm font-semibold text-stone-600">Prix HT</th>
                        <th class="px-4 py-3 text-right text-sm font-semibold text-stone-600">Coût</th>
                        <th class="px-4 py-3 text-right text-sm font-semibold text-stone-600">Marge</th>
                        <th class="px-4 py-3 text-right text-sm font-semibold text-stone-600">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-stone-100">
                    ${produits.map(p => `
                        <tr class="hover:bg-amber-50/50 transition-colors">
                            <td class="px-4 py-3 text-sm">${p.reference}</td>
                            <td class="px-4 py-3 text-sm font-medium">${p.description}</td>
                            <td class="px-4 py-3 text-sm text-right">${formatMoney(p.prixHT)}</td>
                            <td class="px-4 py-3 text-sm text-right">${formatMoney(p.coutAchat)}</td>
                            <td class="px-4 py-3 text-sm text-right ${p.marge > 0 ? 'text-emerald-600 font-medium' : 'text-stone-400'}">${(p.marge || 0).toFixed(2)}</td>
                            <td class="px-4 py-3 text-right">
                                <button onclick="openProduitModal('${p.reference}')" class="p-1.5 text-amber-500 hover:bg-amber-50 rounded-lg">✏️</button>
                                <button onclick="deleteProduit('${p.reference}')" class="p-1.5 text-red-500 hover:bg-red-50 rounded-lg">🗑️</button>
                            </td>
                        </tr>
                    `).join('') || '<tr><td colspan="6" class="px-4 py-8 text-center text-stone-400">Aucun produit</td></tr>'}
                </tbody>
            </table>
        </div>
    `;
}

function renderProduitsParCategorie(produitsParCategorie) {
    return `
        <div class="space-y-6">
            ${data.categories.map(cat => {
                const produits = produitsParCategorie[cat.id] || [];
                if (produits.length === 0) return '';
                return `
                    <div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-stone-200">
                        <div class="bg-gradient-to-r from-amber-50 to-orange-50 px-4 py-3 border-b border-stone-200 flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">${cat.icon}</span>
                                <h3 class="font-semibold text-stone-800">${cat.nom}</h3>
                                <span class="bg-amber-100 text-amber-700 text-sm px-2 py-0.5 rounded-full">${produits.length}</span>
                            </div>
                            <button onclick="selectedCategorie = '${cat.id}'; renderPage()" class="text-sm text-amber-600 hover:text-amber-700 font-medium">
                                Voir tout →
                            </button>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 p-4">
                            ${produits.slice(0, 6).map(p => `
                                <div class="bg-stone-50 rounded-xl p-3 hover:bg-amber-50/50 transition-colors cursor-pointer group" onclick="openProduitModal('${p.reference}')">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <p class="text-xs text-stone-400">${p.reference}</p>
                                            <p class="font-medium text-stone-800">${p.description}</p>
                                        </div>
                                        <p class="text-lg font-bold text-amber-600">${formatMoney(p.prixHT)}</p>
                                    </div>
                                    <div class="flex justify-between items-center mt-2 text-xs text-stone-500">
                                        <span>Coût: ${formatMoney(p.coutAchat)}</span>
                                        <span class="${p.marge > 0 ? 'text-emerald-600' : ''}">Marge: ${(p.marge || 0).toFixed(2)}</span>
                                    </div>
                                    <div class="absolute right-2 top-2 opacity-0 group-hover:opacity-100 transition-opacity flex gap-1">
                                        <button onclick="event.stopPropagation(); deleteProduit('${p.reference}')" class="p-1 text-red-500 hover:bg-red-100 rounded">🗑️</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        ${produits.length > 6 ? `<div class="px-4 pb-3 text-center"><button onclick="selectedCategorie = '${cat.id}'; renderPage()" class="text-amber-600 text-sm hover:underline">+ ${produits.length - 6} autres produits</button></div>` : ''}
                    </div>
                `;
            }).join('')}
            ${produitsParCategorie['_autres']?.length > 0 ? `
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-stone-200">
                    <div class="bg-stone-100 px-4 py-3 border-b border-stone-200">
                        <h3 class="font-semibold text-stone-800">📦 Sans catégorie (${produitsParCategorie['_autres'].length})</h3>
                    </div>
                    ${renderProduitsTable(produitsParCategorie['_autres'])}
                </div>
            ` : ''}
        </div>
    `;
}

function openProduitModal(reference = null) {
    const defaultCategorie = selectedCategorie || data.categories[0]?.id || 'divers';
    const produit = reference ? data.produits.find(p => p.reference === reference) : {
        reference: generateProductReference(defaultCategorie),
        description: '', prixHT: 0, tauxTVA: 0, coutAchat: 0, marge: 0, categorie: defaultCategorie
    };
    const isEdit = !!reference;

    const content = `
        <div class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <div><label class="block text-sm font-medium text-stone-600 mb-1">Catégorie</label>
                    <select id="produit-categorie" ${isEdit ? '' : 'onchange="updateProductReference()"'} class="w-full px-4 py-2.5 border border-stone-300 rounded-xl">
                        ${data.categories.map(c => `<option value="${c.id}" ${produit.categorie === c.id ? 'selected' : ''}>${c.icon} ${c.nom}</option>`).join('')}
                    </select></div>
                <div><label class="block text-sm font-medium text-stone-600 mb-1">Référence</label>
                    <input type="text" id="produit-ref" value="${produit.reference}" ${isEdit ? 'disabled' : 'readonly'} class="w-full px-4 py-2.5 border border-stone-300 rounded-xl bg-stone-100 font-mono font-bold text-amber-600"></div>
            </div>
            <div><label class="block text-sm font-medium text-stone-600 mb-1">Description</label>
                <input type="text" id="produit-desc" value="${produit.description}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
            <div class="grid grid-cols-2 gap-4">
                <div><label class="block text-sm font-medium text-stone-600 mb-1">Prix HT (€)</label>
                    <input type="number" step="0.01" id="produit-prix" value="${produit.prixHT}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
                <div><label class="block text-sm font-medium text-stone-600 mb-1">Taux TVA (%)</label>
                    <select id="produit-tva" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl">
                        ${data.tauxTVA.map(t => `<option value="${t}" ${produit.tauxTVA === t ? 'selected' : ''}>${t} %</option>`).join('')}
                    </select></div>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div><label class="block text-sm font-medium text-stone-600 mb-1">Coût d'achat (€)</label>
                    <input type="number" step="0.01" id="produit-cout" value="${produit.coutAchat}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
                <div><label class="block text-sm font-medium text-stone-600 mb-1">Coefficient de marge</label>
                    <input type="number" step="0.01" id="produit-marge" value="${produit.marge}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
            </div>
        </div>
        <div class="flex justify-end gap-3 mt-6">
            <button onclick="closeModal()" class="px-4 py-2.5 bg-stone-100 text-stone-700 rounded-xl font-medium">Annuler</button>
            <button onclick="saveProduit('${reference || ''}')" class="btn-primary text-white px-4 py-2.5 rounded-xl font-medium">${isEdit ? 'Enregistrer' : 'Créer'}</button>
        </div>
    `;
    showModal(isEdit ? 'Modifier produit' : 'Nouveau produit', content, 'max-w-xl');
}

function updateProductReference() {
    const categorieId = document.getElementById('produit-categorie').value;
    const newRef = generateProductReference(categorieId);
    document.getElementById('produit-ref').value = newRef;
}

function saveProduit(oldRef) {
    const produit = {
        reference: document.getElementById('produit-ref').value,
        description: document.getElementById('produit-desc').value,
        prixHT: parseFloat(document.getElementById('produit-prix').value) || 0,
        tauxTVA: parseFloat(document.getElementById('produit-tva').value) || 0,
        coutAchat: parseFloat(document.getElementById('produit-cout').value) || 0,
        marge: parseFloat(document.getElementById('produit-marge').value) || 0,
        categorie: document.getElementById('produit-categorie').value
    };

    if (oldRef) {
        const idx = data.produits.findIndex(p => p.reference === oldRef);
        if (idx !== -1) data.produits[idx] = produit;
    } else {
        data.produits.push(produit);
    }

    saveData();
    closeModal();
    renderPage();
}

function deleteProduit(reference) {
    if (confirm('Supprimer ce produit ?')) {
        data.produits = data.produits.filter(p => p.reference !== reference);
        saveData();
        renderPage();
    }
}

// ============================================
// GESTION DES CATÉGORIES
// ============================================
function openCategorieModal() {
    renderCategorieModal();
}

function renderCategorieModal() {
    const content = `
        <div class="space-y-4">
            <div class="bg-amber-50 border border-amber-200 rounded-xl p-3 text-sm text-amber-800">
                💡 Les catégories permettent d'organiser vos produits. Chaque produit appartient à une catégorie.
            </div>
            
            <!-- Liste des catégories -->
            <div class="space-y-2">
                ${data.categories.map((cat, index) => {
                    const count = data.produits.filter(p => p.categorie === cat.id).length;
                    return `
                        <div class="flex items-center justify-between bg-stone-50 rounded-xl p-3 hover:bg-stone-100 transition-colors">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl">${cat.icon}</span>
                                <div>
                                    <p class="font-medium text-stone-800">${cat.nom}</p>
                                    <p class="text-xs text-stone-500">${count} produit${count > 1 ? 's' : ''}</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="editCategorie('${cat.id}')" class="p-2 text-amber-500 hover:bg-amber-100 rounded-lg" title="Modifier">✏️</button>
                                ${count === 0 ? `<button onclick="deleteCategorie('${cat.id}')" class="p-2 text-red-500 hover:bg-red-100 rounded-lg" title="Supprimer">🗑️</button>` : ''}
                            </div>
                        </div>
                    `;
                }).join('')}
            </div>
            
            <!-- Formulaire nouvelle catégorie -->
            <div class="border-t border-stone-200 pt-4 mt-4">
                <h4 class="font-medium text-stone-700 mb-3">➕ Ajouter une catégorie</h4>
                <div class="grid grid-cols-3 gap-3">
                    <div>
                        <label class="block text-xs text-stone-500 mb-1">Icône (emoji)</label>
                        <input type="text" id="new-cat-icon" placeholder="📦" maxlength="2" class="w-full px-3 py-2 border border-stone-300 rounded-lg text-center text-2xl">
                    </div>
                    <div class="col-span-2">
                        <label class="block text-xs text-stone-500 mb-1">Nom de la catégorie</label>
                        <input type="text" id="new-cat-nom" placeholder="Nouvelle catégorie" class="w-full px-3 py-2 border border-stone-300 rounded-lg">
                    </div>
                </div>
                <button onclick="addCategorie()" class="mt-3 w-full btn-primary text-white py-2 rounded-lg font-medium">
                    Ajouter la catégorie
                </button>
            </div>
        </div>
        <div class="flex justify-end mt-6">
            <button onclick="closeModal()" class="px-4 py-2.5 bg-stone-100 text-stone-700 rounded-xl font-medium">Fermer</button>
        </div>
    `;
    showModal('📁 Gérer les catégories', content, 'max-w-lg');
}

function addCategorie() {
    const icon = document.getElementById('new-cat-icon').value.trim() || '📦';
    const nom = document.getElementById('new-cat-nom').value.trim();
    
    if (!nom) {
        alert('Veuillez saisir un nom de catégorie');
        return;
    }
    
    // Générer un ID unique
    const id = nom.toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g, '') // Enlever accents
        .replace(/[^a-z0-9]/g, '_') // Remplacer caractères spéciaux
        .replace(/_+/g, '_'); // Éviter doubles underscores
    
    // Vérifier si l'ID existe déjà
    if (data.categories.find(c => c.id === id)) {
        alert('Une catégorie avec ce nom existe déjà');
        return;
    }
    
    data.categories.push({ id, nom, icon });
    saveData();
    renderCategorieModal();
    renderPage();
}

function editCategorie(catId) {
    const cat = data.categories.find(c => c.id === catId);
    if (!cat) return;
    
    const content = `
        <div class="space-y-4">
            <div class="grid grid-cols-3 gap-3">
                <div>
                    <label class="block text-xs text-stone-500 mb-1">Icône (emoji)</label>
                    <input type="text" id="edit-cat-icon" value="${cat.icon}" maxlength="2" class="w-full px-3 py-2 border border-stone-300 rounded-lg text-center text-2xl">
                </div>
                <div class="col-span-2">
                    <label class="block text-xs text-stone-500 mb-1">Nom de la catégorie</label>
                    <input type="text" id="edit-cat-nom" value="${cat.nom}" class="w-full px-3 py-2 border border-stone-300 rounded-lg">
                </div>
            </div>
        </div>
        <div class="flex justify-end gap-3 mt-6">
            <button onclick="renderCategorieModal()" class="px-4 py-2.5 bg-stone-100 text-stone-700 rounded-xl font-medium">Annuler</button>
            <button onclick="saveCategorie('${catId}')" class="btn-primary text-white px-4 py-2.5 rounded-xl font-medium">Enregistrer</button>
        </div>
    `;
    showModal('✏️ Modifier la catégorie', content, 'max-w-md');
}

function saveCategorie(catId) {
    const cat = data.categories.find(c => c.id === catId);
    if (!cat) return;
    
    const newIcon = document.getElementById('edit-cat-icon').value.trim() || '📦';
    const newNom = document.getElementById('edit-cat-nom').value.trim();
    
    if (!newNom) {
        alert('Veuillez saisir un nom');
        return;
    }
    
    cat.icon = newIcon;
    cat.nom = newNom;
    saveData();
    renderCategorieModal();
    renderPage();
}

function deleteCategorie(catId) {
    const cat = data.categories.find(c => c.id === catId);
    if (!cat) return;
    
    const count = data.produits.filter(p => p.categorie === catId).length;
    if (count > 0) {
        alert(`Impossible de supprimer cette catégorie : ${count} produit(s) y sont associés.`);
        return;
    }
    
    if (confirm(`Supprimer la catégorie "${cat.nom}" ?`)) {
        data.categories = data.categories.filter(c => c.id !== catId);
        saveData();
        renderCategorieModal();
        renderPage();
    }
}

// ============================================
// FACTURES
// ============================================
function renderFactures() {
    return `
        <div class="space-y-6">
            <div class="flex items-center justify-between">
                <h2 class="text-2xl font-bold text-stone-800">Factures (${data.factures.length})</h2>
                <button onclick="openFactureModal()" class="btn-primary text-white px-4 py-2.5 rounded-xl font-medium flex items-center gap-2">
                    <span>+</span> Nouvelle facture
                </button>
            </div>
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-stone-200">
                <table class="w-full">
                    <thead class="bg-gradient-to-r from-stone-100 to-stone-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-stone-600">N° Facture</th>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-stone-600">Date</th>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-stone-600">Client</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold text-stone-600">Total TTC</th>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-stone-600">Règlement</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold text-stone-600">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-stone-100">
                        ${data.factures.map(f => `
                            <tr class="hover:bg-amber-50/50 transition-colors">
                                <td class="px-4 py-3 text-sm font-medium">${f.numero}</td>
                                <td class="px-4 py-3 text-sm">${formatDate(f.date)}</td>
                                <td class="px-4 py-3 text-sm">${getClientName(f)}</td>
                                <td class="px-4 py-3 text-sm text-right font-medium">${formatMoney(f.totalTTC)}</td>
                                <td class="px-4 py-3 text-sm">${f.modeReglement}</td>
                                <td class="px-4 py-3 text-right">
                                    <button onclick="viewFacture('${f.numero}')" class="p-1.5 text-blue-500 hover:bg-blue-50 rounded-lg" title="Voir/Imprimer">👁️</button>
                                    <button onclick="openFactureModal('${f.numero}')" class="p-1.5 text-amber-500 hover:bg-amber-50 rounded-lg" title="Modifier">✏️</button>
                                    <button onclick="deleteFacture('${f.numero}')" class="p-1.5 text-red-500 hover:bg-red-50 rounded-lg" title="Supprimer">🗑️</button>
                                </td>
                            </tr>
                        `).join('') || '<tr><td colspan="6" class="px-4 py-8 text-center text-stone-400">Aucune facture</td></tr>'}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function openFactureModal(numero = null) {
    currentFacture = numero ? JSON.parse(JSON.stringify(data.factures.find(f => f.numero === numero))) : {
        numero: generateNumber('F', data.factures),
        clientId: data.clients[0]?.numero || '',
        paiementComptoir: false,
        date: new Date().toISOString().split('T')[0],
        dateEcheance: new Date(Date.now() + 30*24*60*60*1000).toISOString().split('T')[0],
        modeReglement: data.moyensReglement[0],
        remise: 0, acompte: 0, lignes: [], notes: ''
    };
    // Migration pour anciennes factures sans paiementComptoir
    if (currentFacture.paiementComptoir === undefined) currentFacture.paiementComptoir = false;
    renderFactureModal();
}

function renderFactureModal() {
    const f = currentFacture;
    const client = f.paiementComptoir ? null : getClient(f.clientId);
    
    const totalHT = f.lignes.reduce((sum, l) => sum + (l.prixHT * l.quantite), 0);
    const totalHTRemise = totalHT * (1 - f.remise / 100);
    const totalTTC = data.entreprise.exonereTVA ? totalHTRemise : totalHTRemise * 1.2;

    const content = `
        <div class="space-y-6">
            <div class="grid grid-cols-2 gap-6">
                <div class="bg-stone-50 rounded-xl p-4">
                    <h3 class="font-semibold text-stone-800 mb-2">${data.entreprise.nom}</h3>
                    <p class="text-sm text-stone-600">${data.entreprise.adresse}<br>${data.entreprise.codePostal} ${data.entreprise.ville}</p>
                </div>
                <div class="space-y-3">
                    <!-- Case Paiement Comptoir -->
                    <label class="flex items-center gap-3 p-3 bg-amber-50 border border-amber-200 rounded-xl cursor-pointer hover:bg-amber-100 transition-colors">
                        <input type="checkbox" id="facture-comptoir" ${f.paiementComptoir ? 'checked' : ''} onchange="currentFacture.paiementComptoir = this.checked; if(this.checked) currentFacture.clientId = ''; renderFactureModal()" class="w-5 h-5 rounded text-amber-500">
                        <div>
                            <span class="font-medium text-amber-800">🛒 Paiement comptoir</span>
                            <p class="text-xs text-amber-600">Vente directe sans client enregistré</p>
                        </div>
                    </label>
                    
                    ${!f.paiementComptoir ? `
                        <label class="block text-sm font-medium text-stone-600 mb-1">Client</label>
                        <div class="relative">
                            <input type="text" id="client-search" placeholder="Rechercher un client..." 
                                   oninput="filterClients(this.value)" 
                                   onfocus="showClientSuggestions()" 
                                   class="w-full px-4 py-2.5 border border-stone-300 rounded-xl mb-2">
                            <div id="client-suggestions" class="hidden absolute z-50 w-full bg-white border border-stone-300 rounded-xl shadow-lg max-h-48 overflow-y-auto"></div>
                        </div>
                        <select id="facture-client" onchange="currentFacture.clientId = this.value; renderFactureModal()" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl">
                            ${data.clients.map(c => `<option value="${c.numero}" ${f.clientId === c.numero ? 'selected' : ''}>${c.numero} - ${c.nom}</option>`).join('')}
                        </select>
                        ${client ? `<div class="bg-amber-50 rounded-xl p-3 text-sm mt-2"><p class="font-medium">${client.nom}</p><p class="text-stone-600">${client.adresse || ''}</p><p class="text-stone-600">${client.codePostal || ''} ${client.ville || ''}</p></div>` : ''}
                    ` : `
                        <div class="bg-green-50 border border-green-200 rounded-xl p-3 text-sm">
                            <p class="font-medium text-green-800">✓ Paiement comptoir</p>
                            <p class="text-green-600">La facture sera émise sans nom de client</p>
                        </div>
                    `}
                </div>
            </div>
            <div class="grid grid-cols-4 gap-4">
                <div><label class="block text-sm font-medium text-stone-600 mb-1">N° Facture</label>
                    <input type="text" value="${f.numero}" disabled class="w-full px-4 py-2.5 border border-stone-300 rounded-xl bg-stone-100"></div>
                <div><label class="block text-sm font-medium text-stone-600 mb-1">Date</label>
                    <input type="date" id="facture-date" value="${f.date}" onchange="currentFacture.date = this.value" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
                <div><label class="block text-sm font-medium text-stone-600 mb-1">Échéance</label>
                    <input type="date" id="facture-echeance" value="${f.dateEcheance}" onchange="currentFacture.dateEcheance = this.value" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
                <div><label class="block text-sm font-medium text-stone-600 mb-1">Mode règlement</label>
                    <select id="facture-reglement" onchange="currentFacture.modeReglement = this.value" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl">
                        ${data.moyensReglement.map(m => `<option value="${m}" ${f.modeReglement === m ? 'selected' : ''}>${m}</option>`).join('')}
                    </select></div>
            </div>
            <div class="space-y-3">
                <div class="flex items-center justify-between">
                    <h3 class="font-semibold text-stone-800">Lignes de facture</h3>
                    <button onclick="showProductPicker()" class="btn-primary text-white px-3 py-1.5 rounded-lg text-sm">+ Ajouter produit</button>
                </div>
                <div id="product-picker" class="hidden bg-stone-50 rounded-xl p-4 space-y-3">
                    <input type="text" id="product-search" placeholder="Rechercher un produit..." oninput="filterProducts(this.value)" class="w-full px-4 py-2 border border-stone-300 rounded-lg">
                    <div id="product-list" class="max-h-48 overflow-y-auto space-y-1"></div>
                </div>
                <div class="bg-white border border-stone-200 rounded-xl overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-stone-100">
                            <tr>
                                <th class="px-3 py-2 text-left text-sm">Réf.</th>
                                <th class="px-3 py-2 text-left text-sm">Description</th>
                                <th class="px-3 py-2 text-right text-sm">Prix HT</th>
                                <th class="px-3 py-2 text-center text-sm w-20">Qté</th>
                                <th class="px-3 py-2 text-right text-sm">Total</th>
                                <th class="px-3 py-2 w-10"></th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-stone-100">
                            ${f.lignes.length === 0 ? '<tr><td colspan="6" class="px-4 py-6 text-center text-stone-400">Aucun produit</td></tr>' :
                            f.lignes.map((l, i) => `
                                <tr>
                                    <td class="px-3 py-2 text-sm">${l.reference}</td>
                                    <td class="px-3 py-2 text-sm">${l.description}</td>
                                    <td class="px-3 py-2 text-sm text-right">${formatMoney(l.prixHT)}</td>
                                    <td class="px-3 py-2"><input type="number" min="1" value="${l.quantite}" onchange="updateLigneQte(${i}, this.value)" class="w-16 text-center border border-stone-300 rounded px-2 py-1"></td>
                                    <td class="px-3 py-2 text-sm text-right font-medium">${formatMoney(l.prixHT * l.quantite)}</td>
                                    <td class="px-3 py-2"><button onclick="removeLigne(${i})" class="text-red-500 hover:bg-red-50 p-1 rounded">✕</button></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="flex justify-end">
                <div class="w-72 space-y-2 bg-stone-50 rounded-xl p-4">
                    <div class="flex justify-between text-sm"><span>Total HT</span><span class="font-medium">${formatMoney(totalHT)}</span></div>
                    <div class="flex justify-between text-sm items-center">
                        <span>Remise (%)</span>
                        <input type="number" min="0" max="100" value="${f.remise}" onchange="currentFacture.remise = parseFloat(this.value) || 0; renderFactureModal()" class="w-16 text-right border border-stone-300 rounded px-2 py-1">
                    </div>
                    ${f.remise > 0 ? `<div class="flex justify-between text-sm text-red-600"><span>Après remise</span><span>${formatMoney(totalHTRemise)}</span></div>` : ''}
                    <div class="flex justify-between text-lg font-bold border-t border-stone-300 pt-2">
                        <span>Total TTC</span><span class="text-amber-600">${formatMoney(totalTTC)}</span>
                    </div>
                </div>
            </div>
            ${data.entreprise.exonereTVA ? '<div class="bg-amber-50 border border-amber-200 rounded-xl px-4 py-2 text-sm text-amber-800">TVA non applicable, article 293B du CGI</div>' : ''}
        </div>
        <div class="flex justify-end gap-3 mt-6">
            <button onclick="closeModal()" class="px-4 py-2.5 bg-stone-100 text-stone-700 rounded-xl font-medium">Annuler</button>
            <button onclick="saveFacture()" class="btn-primary text-white px-4 py-2.5 rounded-xl font-medium">Enregistrer</button>
        </div>
    `;
    showModal('Facture ' + currentFacture.numero, content, 'max-w-4xl');
}

// Recherche rapide client
function filterClients(query) {
    const suggestions = document.getElementById('client-suggestions');
    if (!query || query.length < 1) {
        suggestions.classList.add('hidden');
        return;
    }
    
    const q = query.toLowerCase();
    const filtered = data.clients.filter(c => 
        c.nom.toLowerCase().includes(q) || 
        c.numero.toLowerCase().includes(q) ||
        (c.email && c.email.toLowerCase().includes(q)) ||
        (c.telephone && c.telephone.includes(q))
    ).slice(0, 8);
    
    if (filtered.length > 0) {
        suggestions.innerHTML = filtered.map(c => `
            <div onclick="selectClient('${c.numero}')" 
                 class="px-4 py-2 hover:bg-amber-50 cursor-pointer border-b border-stone-100 last:border-0">
                <span class="font-medium text-amber-600">${c.numero}</span> - ${c.nom}
                ${c.ville ? `<span class="text-stone-400 text-sm ml-2">(${c.ville})</span>` : ''}
            </div>
        `).join('');
        suggestions.classList.remove('hidden');
    } else {
        suggestions.classList.add('hidden');
    }
}

function showClientSuggestions() {
    const input = document.getElementById('client-search');
    if (input.value.length >= 1) {
        filterClients(input.value);
    }
}

function selectClient(numero) {
    currentFacture.clientId = numero;
    document.getElementById('client-suggestions').classList.add('hidden');
    document.getElementById('client-search').value = '';
    renderFactureModal();
}

// Fermer les suggestions si on clique ailleurs
document.addEventListener('click', function(e) {
    const suggestions = document.getElementById('client-suggestions');
    const searchInput = document.getElementById('client-search');
    if (suggestions && searchInput && !suggestions.contains(e.target) && e.target !== searchInput) {
        suggestions.classList.add('hidden');
    }
});

function showProductPicker() {
    document.getElementById('product-picker').classList.remove('hidden');
    filterProducts('');
}

function filterProducts(search) {
    const filtered = data.produits.filter(p => 
        p.description.toLowerCase().includes(search.toLowerCase()) || 
        p.reference.toLowerCase().includes(search.toLowerCase())
    ).slice(0, 10);
    
    document.getElementById('product-list').innerHTML = filtered.map(p => `
        <button onclick="addProductToFacture('${p.reference}')" class="w-full text-left px-3 py-2 hover:bg-amber-100 rounded-lg transition-colors flex justify-between">
            <span>${p.reference} - ${p.description}</span>
            <span class="text-amber-600 font-medium">${formatMoney(p.prixHT)}</span>
        </button>
    `).join('') || '<p class="text-stone-400 text-center py-2">Aucun produit</p>';
}

function addProductToFacture(reference) {
    const produit = data.produits.find(p => p.reference === reference);
    if (produit) {
        currentFacture.lignes.push({
            id: Date.now(),
            reference: produit.reference,
            description: produit.description,
            prixHT: produit.prixHT,
            quantite: 1,
            tauxTVA: produit.tauxTVA
        });
        document.getElementById('product-picker').classList.add('hidden');
        renderFactureModal();
    }
}

function updateLigneQte(index, value) {
    currentFacture.lignes[index].quantite = parseInt(value) || 1;
    renderFactureModal();
}

function removeLigne(index) {
    currentFacture.lignes.splice(index, 1);
    renderFactureModal();
}

function saveFacture() {
    const f = currentFacture;
    const totalHT = f.lignes.reduce((sum, l) => sum + (l.prixHT * l.quantite), 0);
    const totalHTRemise = totalHT * (1 - f.remise / 100);
    const totalTTC = data.entreprise.exonereTVA ? totalHTRemise : totalHTRemise * 1.2;
    
    f.totalHT = totalHT;
    f.totalHTRemise = totalHTRemise;
    f.totalTTC = totalTTC;

    const idx = data.factures.findIndex(x => x.numero === f.numero);
    if (idx !== -1) {
        data.factures[idx] = f;
    } else {
        data.factures.push(f);
    }

    saveData();
    closeModal();
    renderPage();
}

function deleteFacture(numero) {
    if (confirm('Supprimer cette facture ?')) {
        data.factures = data.factures.filter(f => f.numero !== numero);
        saveData();
        renderPage();
    }
}

function viewFacture(numero) {
    const f = data.factures.find(x => x.numero === numero);
    const client = f.paiementComptoir ? null : getClient(f.clientId);
    
    const content = `
        <div id="print-facture">
            <!-- Page 1 : Facture -->
            <div class="print-page">
                <div class="flex justify-between mb-8">
                    <div>
                        ${data.logo ? `<img src="${data.logo}" alt="Logo" class="max-h-16 mb-2">` : `<h2 class="text-xl font-bold">${data.entreprise.nom}</h2>`}
                        <p class="text-sm text-stone-600">${data.entreprise.complement}</p>
                        <p class="text-sm text-stone-600">${data.entreprise.adresse}</p>
                        <p class="text-sm text-stone-600">${data.entreprise.codePostal} ${data.entreprise.ville}</p>
                        <p class="text-sm text-stone-600">Tél : ${data.entreprise.telephone}</p>
                        <p class="text-sm text-stone-600 mt-2">Siret : ${data.entreprise.siret}</p>
                        <p class="text-sm text-stone-600">IBAN : ${data.entreprise.iban}</p>
                        <p class="text-sm text-stone-600">BIC : ${data.entreprise.bic}</p>
                    </div>
                    <div class="text-right">
                        <h1 class="text-2xl font-bold text-amber-600">FACTURE</h1>
                        <p class="text-lg font-medium">${f.numero}</p>
                        <p class="text-sm text-stone-600 mt-4">Date : ${formatDate(f.date)}</p>
                        <p class="text-sm text-stone-600">Échéance : ${formatDate(f.dateEcheance)}</p>
                    </div>
                </div>
                <div class="mb-6">
                    <h3 class="text-sm font-semibold text-stone-500 mb-2">DESTINATAIRE</h3>
                    <div class="bg-stone-50 p-4 rounded-lg">
                        ${f.paiementComptoir ? `
                            <p class="font-medium text-amber-700">🛒 Paiement comptoir</p>
                            <p class="text-sm text-stone-500">Vente directe - Client de passage</p>
                        ` : `
                            <p class="font-medium">${client?.nom || '-'}</p>
                            <p class="text-sm">${client?.adresse || ''}</p>
                            <p class="text-sm">${client?.codePostal || ''} ${client?.ville || ''}</p>
                        `}
                    </div>
                </div>
                <table class="w-full border border-stone-200 mb-6">
                    <thead class="bg-stone-100">
                        <tr>
                            <th class="border border-stone-200 px-3 py-2 text-left text-sm">Référence</th>
                            <th class="border border-stone-200 px-3 py-2 text-left text-sm">Description</th>
                            <th class="border border-stone-200 px-3 py-2 text-right text-sm">Prix HT</th>
                            <th class="border border-stone-200 px-3 py-2 text-center text-sm">Qté</th>
                            <th class="border border-stone-200 px-3 py-2 text-right text-sm">Total HT</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${f.lignes.map(l => `
                            <tr>
                                <td class="border border-stone-200 px-3 py-2 text-sm">${l.reference}</td>
                                <td class="border border-stone-200 px-3 py-2 text-sm">${l.description}</td>
                                <td class="border border-stone-200 px-3 py-2 text-sm text-right">${formatMoney(l.prixHT)}</td>
                                <td class="border border-stone-200 px-3 py-2 text-sm text-center">${l.quantite}</td>
                                <td class="border border-stone-200 px-3 py-2 text-sm text-right">${formatMoney(l.prixHT * l.quantite)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                <div class="flex justify-end mb-6">
                    <div class="w-64">
                        <div class="flex justify-between py-1"><span>Total HT</span><span>${formatMoney(f.totalHT)}</span></div>
                        ${f.remise > 0 ? `<div class="flex justify-between py-1 text-red-600"><span>Remise (${f.remise}%)</span><span>-${formatMoney(f.totalHT * f.remise / 100)}</span></div>` : ''}
                        <div class="flex justify-between py-2 border-t-2 border-stone-300 font-bold text-lg"><span>Total TTC</span><span>${formatMoney(f.totalTTC)}</span></div>
                    </div>
                </div>
                ${data.entreprise.exonereTVA ? '<p class="text-sm text-stone-500 italic mb-4">TVA non applicable, article 293B du CGI</p>' : ''}
                <p class="text-sm text-stone-600">Mode de règlement : ${f.modeReglement}</p>
                <p class="text-xs text-stone-400 mt-4">Voir conditions générales de vente au verso</p>
            </div>
        </div>
        <div class="flex justify-end gap-3 mt-6 no-print">
            <button onclick="printFactureWithCGV('${f.numero}')" class="btn-primary text-white px-4 py-2.5 rounded-xl font-medium">🖨️ Imprimer (recto-verso)</button>
        </div>
    `;
    showModal('Facture ' + f.numero, content, 'max-w-3xl');
}

function printFactureWithCGV(numero) {
    const f = data.factures.find(x => x.numero === numero);
    const client = f.paiementComptoir ? null : getClient(f.clientId);
    
    const printWindow = window.open('', '', 'width=800,height=600');
    printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Facture ${f.numero}</title>
            <style>
                body { font-family: Arial, sans-serif; margin: 0; padding: 20mm; font-size: 12px; }
                @page { size: A4; margin: 15mm; }
                .page { page-break-after: always; min-height: 257mm; }
                .page:last-child { page-break-after: auto; }
                table { width: 100%; border-collapse: collapse; margin: 15px 0; }
                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                th { background: #f5f5f5; }
                .text-right { text-align: right; }
                .text-center { text-align: center; }
                .header { display: flex; justify-content: space-between; margin-bottom: 30px; }
                .totals { width: 250px; margin-left: auto; }
                .totals div { display: flex; justify-content: space-between; padding: 5px 0; }
                .total-line { border-top: 2px solid #333; font-weight: bold; font-size: 14px; }
                h1 { color: #f59e0b; margin: 0; }
                .cgv-title { font-size: 14px; font-weight: bold; margin-bottom: 15px; text-align: center; }
                .cgv-content { font-size: 9px; line-height: 1.4; column-count: 2; column-gap: 20px; }
            </style>
        </head>
        <body>
            <!-- Page 1: Facture -->
            <div class="page">
                <div class="header">
                    <div>
                        ${data.logo ? `<img src="${data.logo}" style="max-height:60px;margin-bottom:10px">` : `<h2 style="margin:0">${data.entreprise.nom}</h2>`}
                        <p>${data.entreprise.complement}<br>${data.entreprise.adresse}<br>${data.entreprise.codePostal} ${data.entreprise.ville}<br>Tél: ${data.entreprise.telephone}</p>
                        <p style="margin-top:10px">Siret: ${data.entreprise.siret}<br>IBAN: ${data.entreprise.iban}<br>BIC: ${data.entreprise.bic}</p>
                    </div>
                    <div style="text-align:right">
                        <h1>FACTURE</h1>
                        <p style="font-size:16px;font-weight:bold">${f.numero}</p>
                        <p style="margin-top:15px">Date: ${formatDate(f.date)}<br>Échéance: ${formatDate(f.dateEcheance)}</p>
                    </div>
                </div>
                <div style="background:#f5f5f5;padding:15px;margin-bottom:20px">
                    <strong>DESTINATAIRE</strong><br>
                    ${f.paiementComptoir ? `
                        <span style="color:#d97706;font-weight:bold">🛒 Paiement comptoir</span><br>
                        <span style="color:#666">Vente directe - Client de passage</span>
                    ` : `
                        ${client?.nom || '-'}<br>
                        ${client?.adresse || ''}<br>
                        ${client?.codePostal || ''} ${client?.ville || ''}
                    `}
                </div>
                <table>
                    <thead><tr><th>Réf.</th><th>Description</th><th class="text-right">Prix HT</th><th class="text-center">Qté</th><th class="text-right">Total HT</th></tr></thead>
                    <tbody>
                        ${f.lignes.map(l => `<tr><td>${l.reference}</td><td>${l.description}</td><td class="text-right">${formatMoney(l.prixHT)}</td><td class="text-center">${l.quantite}</td><td class="text-right">${formatMoney(l.prixHT * l.quantite)}</td></tr>`).join('')}
                    </tbody>
                </table>
                <div class="totals">
                    <div><span>Total HT</span><span>${formatMoney(f.totalHT)}</span></div>
                    ${f.remise > 0 ? `<div style="color:red"><span>Remise (${f.remise}%)</span><span>-${formatMoney(f.totalHT * f.remise / 100)}</span></div>` : ''}
                    <div class="total-line"><span>Total TTC</span><span>${formatMoney(f.totalTTC)}</span></div>
                </div>
                ${data.entreprise.exonereTVA ? '<p style="font-style:italic;color:#666;margin-top:20px">TVA non applicable, article 293B du CGI</p>' : ''}
                <p style="margin-top:15px">Mode de règlement: ${f.modeReglement}</p>
                <p style="font-size:10px;color:#999;margin-top:30px">Voir conditions générales de vente au verso</p>
            </div>
            <!-- Page 2: CGV -->
            <div class="page">
                <div class="cgv-title">CONDITIONS GÉNÉRALES DE VENTE</div>
                <div class="cgv-content">${data.cgv.replace(/\n/g, '<br>')}</div>
            </div>
        </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.print();
}

// ============================================
// DEVIS (similaire aux factures)
// ============================================
function renderDevis() {
    return `
        <div class="space-y-6">
            <div class="flex items-center justify-between">
                <h2 class="text-2xl font-bold text-stone-800">Devis (${data.devis.length})</h2>
                <button onclick="openDevisModal()" class="btn-primary text-white px-4 py-2.5 rounded-xl font-medium">+ Nouveau devis</button>
            </div>
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden border border-stone-200">
                <table class="w-full">
                    <thead class="bg-gradient-to-r from-stone-100 to-stone-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-stone-600">N° Devis</th>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-stone-600">Date</th>
                            <th class="px-4 py-3 text-left text-sm font-semibold text-stone-600">Client</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold text-stone-600">Total TTC</th>
                            <th class="px-4 py-3 text-right text-sm font-semibold text-stone-600">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-stone-100">
                        ${data.devis.map(d => `
                            <tr class="hover:bg-amber-50/50">
                                <td class="px-4 py-3 text-sm font-medium">${d.numero}</td>
                                <td class="px-4 py-3 text-sm">${formatDate(d.date)}</td>
                                <td class="px-4 py-3 text-sm">${getClient(d.clientId)?.nom || '-'}</td>
                                <td class="px-4 py-3 text-sm text-right font-medium">${formatMoney(d.totalTTC)}</td>
                                <td class="px-4 py-3 text-right">
                                    <button onclick="viewDevis('${d.numero}')" class="p-1.5 text-blue-500 hover:bg-blue-50 rounded-lg">👁️</button>
                                    <button onclick="convertDevisToFacture('${d.numero}')" class="p-1.5 text-green-500 hover:bg-green-50 rounded-lg" title="Convertir en facture">➡️🧾</button>
                                    <button onclick="deleteDevis('${d.numero}')" class="p-1.5 text-red-500 hover:bg-red-50 rounded-lg">🗑️</button>
                                </td>
                            </tr>
                        `).join('') || '<tr><td colspan="5" class="px-4 py-8 text-center text-stone-400">Aucun devis</td></tr>'}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function openDevisModal() {
    currentFacture = {
        numero: generateNumber('D', data.devis),
        clientId: data.clients[0]?.numero || '',
        date: new Date().toISOString().split('T')[0],
        dateEcheance: new Date(Date.now() + 30*24*60*60*1000).toISOString().split('T')[0],
        modeReglement: data.moyensReglement[0],
        remise: 0, lignes: []
    };
    renderDevisModal();
}

function renderDevisModal() {
    const f = currentFacture;
    const client = getClient(f.clientId);
    
    const totalHT = f.lignes.reduce((sum, l) => sum + (l.prixHT * l.quantite), 0);
    const totalHTRemise = totalHT * (1 - f.remise / 100);
    const totalTTC = data.entreprise.exonereTVA ? totalHTRemise : totalHTRemise * 1.2;

    const content = `
        <div class="space-y-6">
            <div class="grid grid-cols-2 gap-6">
                <div class="bg-stone-50 rounded-xl p-4">
                    <h3 class="font-semibold text-stone-800 mb-2">${data.entreprise.nom}</h3>
                    <p class="text-sm text-stone-600">${data.entreprise.adresse}<br>${data.entreprise.codePostal} ${data.entreprise.ville}</p>
                </div>
                <div class="space-y-3">
                    <label class="block text-sm font-medium text-stone-600 mb-1">Client</label>
                    <div class="relative">
                        <input type="text" id="devis-client-search" placeholder="Rechercher un client..." 
                               oninput="filterClientsDevis(this.value)" 
                               onfocus="showClientSuggestionsDevis()" 
                               class="w-full px-4 py-2.5 border border-stone-300 rounded-xl mb-2">
                        <div id="devis-client-suggestions" class="hidden absolute z-50 w-full bg-white border border-stone-300 rounded-xl shadow-lg max-h-48 overflow-y-auto"></div>
                    </div>
                    <select id="devis-client" onchange="currentFacture.clientId = this.value; renderDevisModal()" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl">
                        ${data.clients.map(c => `<option value="${c.numero}" ${f.clientId === c.numero ? 'selected' : ''}>${c.numero} - ${c.nom}</option>`).join('')}
                    </select>
                    ${client ? `<div class="bg-blue-50 rounded-xl p-3 text-sm mt-2"><p class="font-medium">${client.nom}</p><p class="text-stone-600">${client.adresse || ''}</p><p class="text-stone-600">${client.codePostal || ''} ${client.ville || ''}</p></div>` : ''}
                </div>
            </div>
            <div class="grid grid-cols-4 gap-4">
                <div><label class="block text-sm font-medium text-stone-600 mb-1">N° Devis</label>
                    <input type="text" value="${f.numero}" disabled class="w-full px-4 py-2.5 border border-stone-300 rounded-xl bg-stone-100"></div>
                <div><label class="block text-sm font-medium text-stone-600 mb-1">Date</label>
                    <input type="date" id="devis-date" value="${f.date}" onchange="currentFacture.date = this.value" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
                <div><label class="block text-sm font-medium text-stone-600 mb-1">Validité</label>
                    <input type="date" id="devis-validite" value="${f.dateEcheance}" onchange="currentFacture.dateEcheance = this.value" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
                <div><label class="block text-sm font-medium text-stone-600 mb-1">Mode règlement</label>
                    <select id="devis-reglement" onchange="currentFacture.modeReglement = this.value" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl">
                        ${data.moyensReglement.map(m => `<option value="${m}" ${f.modeReglement === m ? 'selected' : ''}>${m}</option>`).join('')}
                    </select></div>
            </div>
            <div class="space-y-3">
                <div class="flex items-center justify-between">
                    <h3 class="font-semibold text-stone-800">Lignes du devis</h3>
                    <button onclick="showProductPickerDevis()" class="btn-primary text-white px-3 py-1.5 rounded-lg text-sm">+ Ajouter produit</button>
                </div>
                <div id="devis-product-picker" class="hidden bg-stone-50 rounded-xl p-4 space-y-3">
                    <input type="text" id="devis-product-search" placeholder="Rechercher un produit..." oninput="filterProductsDevis(this.value)" class="w-full px-4 py-2 border border-stone-300 rounded-lg">
                    <div id="devis-product-list" class="max-h-48 overflow-y-auto space-y-1"></div>
                </div>
                <div class="bg-white border border-stone-200 rounded-xl overflow-hidden">
                    <table class="w-full">
                        <thead class="bg-stone-100">
                            <tr>
                                <th class="px-3 py-2 text-left text-sm">Réf.</th>
                                <th class="px-3 py-2 text-left text-sm">Description</th>
                                <th class="px-3 py-2 text-right text-sm">Prix HT</th>
                                <th class="px-3 py-2 text-center text-sm w-20">Qté</th>
                                <th class="px-3 py-2 text-right text-sm">Total</th>
                                <th class="px-3 py-2 w-10"></th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-stone-100">
                            ${f.lignes.length === 0 ? '<tr><td colspan="6" class="px-4 py-6 text-center text-stone-400">Aucun produit</td></tr>' :
                            f.lignes.map((l, i) => `
                                <tr>
                                    <td class="px-3 py-2 text-sm">${l.reference}</td>
                                    <td class="px-3 py-2 text-sm">${l.description}</td>
                                    <td class="px-3 py-2 text-sm text-right">${formatMoney(l.prixHT)}</td>
                                    <td class="px-3 py-2"><input type="number" min="1" value="${l.quantite}" onchange="updateLigneQteDevis(${i}, this.value)" class="w-16 text-center border border-stone-300 rounded px-2 py-1"></td>
                                    <td class="px-3 py-2 text-sm text-right font-medium">${formatMoney(l.prixHT * l.quantite)}</td>
                                    <td class="px-3 py-2"><button onclick="removeLigneDevis(${i})" class="text-red-500 hover:bg-red-50 p-1 rounded">✕</button></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="flex justify-end">
                <div class="w-72 space-y-2 bg-stone-50 rounded-xl p-4">
                    <div class="flex justify-between text-sm"><span>Total HT</span><span class="font-medium">${formatMoney(totalHT)}</span></div>
                    <div class="flex justify-between text-sm items-center">
                        <span>Remise (%)</span>
                        <input type="number" min="0" max="100" value="${f.remise}" onchange="currentFacture.remise = parseFloat(this.value) || 0; renderDevisModal()" class="w-16 text-right border border-stone-300 rounded px-2 py-1">
                    </div>
                    ${f.remise > 0 ? `<div class="flex justify-between text-sm text-red-600"><span>Après remise</span><span>${formatMoney(totalHTRemise)}</span></div>` : ''}
                    <div class="flex justify-between text-lg font-bold border-t border-stone-300 pt-2">
                        <span>Total TTC</span><span class="text-blue-600">${formatMoney(totalTTC)}</span>
                    </div>
                </div>
            </div>
            ${data.entreprise.exonereTVA ? '<div class="bg-blue-50 border border-blue-200 rounded-xl px-4 py-2 text-sm text-blue-800">TVA non applicable, article 293B du CGI</div>' : ''}
        </div>
        <div class="flex justify-end gap-3 mt-6">
            <button onclick="closeModal()" class="px-4 py-2.5 bg-stone-100 text-stone-700 rounded-xl font-medium">Annuler</button>
            <button onclick="saveDevis()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-xl font-medium">Enregistrer le devis</button>
        </div>
    `;
    showModal('📝 Devis ' + currentFacture.numero, content, 'max-w-4xl');
}

// Fonctions spécifiques aux devis
function showProductPickerDevis() {
    document.getElementById('devis-product-picker').classList.remove('hidden');
    filterProductsDevis('');
}

function filterProductsDevis(query) {
    const list = document.getElementById('devis-product-list');
    const q = query.toLowerCase();
    const filtered = data.produits.filter(p => 
        p.reference.toLowerCase().includes(q) || 
        p.description.toLowerCase().includes(q)
    ).slice(0, 20);
    
    list.innerHTML = filtered.map(p => `
        <div onclick="addProductToDevis('${p.reference}')" class="flex justify-between items-center p-2 hover:bg-amber-50 rounded cursor-pointer">
            <div><span class="font-medium text-amber-600">${p.reference}</span> - ${p.description}</div>
            <span class="text-stone-600">${formatMoney(p.prixHT)}</span>
        </div>
    `).join('') || '<div class="text-stone-400 text-center py-2">Aucun produit trouvé</div>';
}

function addProductToDevis(reference) {
    const p = data.produits.find(x => x.reference === reference);
    if (p) {
        const existing = currentFacture.lignes.find(l => l.reference === reference);
        if (existing) {
            existing.quantite++;
        } else {
            currentFacture.lignes.push({
                reference: p.reference,
                description: p.description,
                prixHT: p.prixHT,
                quantite: 1
            });
        }
        renderDevisModal();
    }
}

function updateLigneQteDevis(index, value) {
    currentFacture.lignes[index].quantite = parseInt(value) || 1;
    renderDevisModal();
}

function removeLigneDevis(index) {
    currentFacture.lignes.splice(index, 1);
    renderDevisModal();
}

function filterClientsDevis(query) {
    const suggestions = document.getElementById('devis-client-suggestions');
    if (!query || query.length < 1) {
        suggestions.classList.add('hidden');
        return;
    }
    
    const q = query.toLowerCase();
    const filtered = data.clients.filter(c => 
        c.nom.toLowerCase().includes(q) || 
        c.numero.toLowerCase().includes(q)
    ).slice(0, 8);
    
    if (filtered.length > 0) {
        suggestions.innerHTML = filtered.map(c => `
            <div onclick="selectClientDevis('${c.numero}')" 
                 class="px-4 py-2 hover:bg-blue-50 cursor-pointer border-b border-stone-100 last:border-0">
                <span class="font-medium text-blue-600">${c.numero}</span> - ${c.nom}
            </div>
        `).join('');
        suggestions.classList.remove('hidden');
    } else {
        suggestions.classList.add('hidden');
    }
}

function showClientSuggestionsDevis() {
    const input = document.getElementById('devis-client-search');
    if (input && input.value.length >= 1) {
        filterClientsDevis(input.value);
    }
}

function selectClientDevis(numero) {
    currentFacture.clientId = numero;
    const suggestions = document.getElementById('devis-client-suggestions');
    if (suggestions) suggestions.classList.add('hidden');
    const search = document.getElementById('devis-client-search');
    if (search) search.value = '';
    renderDevisModal();
}

function saveDevis() {
    const d = currentFacture;
    const totalHT = d.lignes.reduce((sum, l) => sum + (l.prixHT * l.quantite), 0);
    const totalHTRemise = totalHT * (1 - d.remise / 100);
    const totalTTC = data.entreprise.exonereTVA ? totalHTRemise : totalHTRemise * 1.2;
    
    d.totalHT = totalHT;
    d.totalHTRemise = totalHTRemise;
    d.totalTTC = totalTTC;

    const idx = data.devis.findIndex(x => x.numero === d.numero);
    if (idx !== -1) data.devis[idx] = d;
    else data.devis.push(d);

    saveData();
    closeModal();
    renderPage();
}

function viewDevis(numero) {
    const d = data.devis.find(x => x.numero === numero);
    const client = getClient(d.clientId);
    
    const content = `
        <div class="space-y-6">
            <div class="flex justify-between">
                <div>
                    ${data.logo ? `<img src="${data.logo}" class="max-h-16 mb-2">` : `<h2 class="text-xl font-bold">${data.entreprise.nom}</h2>`}
                    <p class="text-sm text-stone-600">${data.entreprise.adresse}<br>${data.entreprise.codePostal} ${data.entreprise.ville}</p>
                </div>
                <div class="text-right">
                    <h1 class="text-2xl font-bold text-blue-600">DEVIS</h1>
                    <p class="text-lg font-medium">${d.numero}</p>
                    <p class="text-sm text-stone-600 mt-2">Date : ${formatDate(d.date)}</p>
                </div>
            </div>
            <div class="bg-stone-50 p-4 rounded-lg">
                <p class="font-medium">${client?.nom || '-'}</p>
                <p class="text-sm">${client?.adresse || ''} ${client?.codePostal || ''} ${client?.ville || ''}</p>
            </div>
            <table class="w-full border border-stone-200">
                <thead class="bg-stone-100"><tr><th class="border px-3 py-2 text-left text-sm">Réf.</th><th class="border px-3 py-2 text-left text-sm">Description</th><th class="border px-3 py-2 text-right text-sm">Prix HT</th><th class="border px-3 py-2 text-center text-sm">Qté</th><th class="border px-3 py-2 text-right text-sm">Total</th></tr></thead>
                <tbody>${d.lignes.map(l => `<tr><td class="border px-3 py-2 text-sm">${l.reference}</td><td class="border px-3 py-2 text-sm">${l.description}</td><td class="border px-3 py-2 text-sm text-right">${formatMoney(l.prixHT)}</td><td class="border px-3 py-2 text-sm text-center">${l.quantite}</td><td class="border px-3 py-2 text-sm text-right">${formatMoney(l.prixHT * l.quantite)}</td></tr>`).join('')}</tbody>
            </table>
            <div class="flex justify-end"><div class="w-64"><div class="flex justify-between py-2 border-t-2 font-bold"><span>Total TTC</span><span>${formatMoney(d.totalTTC)}</span></div></div></div>
        </div>
        <div class="flex justify-end gap-3 mt-6">
            <button onclick="printDevisWithCGV('${d.numero}')" class="btn-primary text-white px-4 py-2.5 rounded-xl font-medium">🖨️ Imprimer</button>
        </div>
    `;
    showModal('Devis ' + d.numero, content, 'max-w-3xl');
}

function printDevisWithCGV(numero) {
    const d = data.devis.find(x => x.numero === numero);
    const client = getClient(d.clientId);
    
    const printWindow = window.open('', '', 'width=800,height=600');
    printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Devis ${d.numero}</title>
            <style>
                body { font-family: Arial, sans-serif; margin: 0; padding: 20mm; font-size: 12px; }
                @page { size: A4; margin: 15mm; }
                .page { page-break-after: always; min-height: 257mm; }
                table { width: 100%; border-collapse: collapse; margin: 15px 0; }
                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
                th { background: #f5f5f5; }
                .text-right { text-align: right; }
                h1 { color: #3b82f6; margin: 0; }
                .cgv-title { font-size: 14px; font-weight: bold; margin-bottom: 15px; text-align: center; }
                .cgv-content { font-size: 9px; line-height: 1.4; column-count: 2; column-gap: 20px; }
            </style>
        </head>
        <body>
            <div class="page">
                <div style="display:flex;justify-content:space-between;margin-bottom:30px">
                    <div>
                        ${data.logo ? `<img src="${data.logo}" style="max-height:60px;margin-bottom:10px">` : `<h2>${data.entreprise.nom}</h2>`}
                        <p>${data.entreprise.adresse}<br>${data.entreprise.codePostal} ${data.entreprise.ville}<br>Tél: ${data.entreprise.telephone}</p>
                    </div>
                    <div style="text-align:right">
                        <h1>DEVIS</h1>
                        <p style="font-size:16px;font-weight:bold">${d.numero}</p>
                        <p>Date: ${formatDate(d.date)}</p>
                    </div>
                </div>
                <div style="background:#f5f5f5;padding:15px;margin-bottom:20px">
                    <strong>DESTINATAIRE</strong><br>${client?.nom || '-'}<br>${client?.adresse || ''}<br>${client?.codePostal || ''} ${client?.ville || ''}
                </div>
                <table>
                    <thead><tr><th>Réf.</th><th>Description</th><th class="text-right">Prix HT</th><th style="text-align:center">Qté</th><th class="text-right">Total</th></tr></thead>
                    <tbody>${d.lignes.map(l => `<tr><td>${l.reference}</td><td>${l.description}</td><td class="text-right">${formatMoney(l.prixHT)}</td><td style="text-align:center">${l.quantite}</td><td class="text-right">${formatMoney(l.prixHT * l.quantite)}</td></tr>`).join('')}</tbody>
                </table>
                <div style="width:250px;margin-left:auto"><div style="display:flex;justify-content:space-between;padding:10px 0;border-top:2px solid #333;font-weight:bold;font-size:14px"><span>Total TTC</span><span>${formatMoney(d.totalTTC)}</span></div></div>
                ${data.entreprise.exonereTVA ? '<p style="font-style:italic;color:#666">TVA non applicable, article 293B du CGI</p>' : ''}
                <p style="font-size:10px;color:#999;margin-top:30px">Devis valable 30 jours. Voir CGV au verso.</p>
            </div>
            <div class="page">
                <div class="cgv-title">CONDITIONS GÉNÉRALES DE VENTE</div>
                <div class="cgv-content">${data.cgv.replace(/\n/g, '<br>')}</div>
            </div>
        </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.print();
}

function convertDevisToFacture(numero) {
    const devis = data.devis.find(d => d.numero === numero);
    if (devis && confirm('Convertir ce devis en facture ?')) {
        const facture = JSON.parse(JSON.stringify(devis));
        facture.numero = generateNumber('F', data.factures);
        facture.date = new Date().toISOString().split('T')[0];
        facture.dateEcheance = new Date(Date.now() + 30*24*60*60*1000).toISOString().split('T')[0];
        data.factures.push(facture);
        saveData();
        alert('Facture ' + facture.numero + ' créée !');
        navigateTo('factures');
    }
}

function deleteDevis(numero) {
    if (confirm('Supprimer ce devis ?')) {
        data.devis = data.devis.filter(d => d.numero !== numero);
        saveData();
        renderPage();
    }
}

// ============================================
// PAIEMENTS
// ============================================
function renderPaiements() {
    const totalFacture = data.factures.reduce((sum, f) => sum + (f.totalTTC || 0), 0);
    const paye = data.factures.filter(f => data.paiements?.find(p => p.numero === f.numero)?.paye);
    const totalPaye = paye.reduce((sum, f) => sum + (f.totalTTC || 0), 0);

    return `
        <div class="space-y-6">
            <h2 class="text-2xl font-bold text-stone-800">Suivi des Paiements</h2>
            <div class="grid grid-cols-3 gap-4">
                <div class="bg-white rounded-xl p-4 border"><p class="text-sm text-stone-500">Total facturé</p><p class="text-2xl font-bold">${formatMoney(totalFacture)}</p></div>
                <div class="bg-emerald-50 rounded-xl p-4 border border-emerald-200"><p class="text-sm text-emerald-600">Encaissé</p><p class="text-2xl font-bold text-emerald-700">${formatMoney(totalPaye)}</p></div>
                <div class="bg-red-50 rounded-xl p-4 border border-red-200"><p class="text-sm text-red-600">Reste</p><p class="text-2xl font-bold text-red-700">${formatMoney(totalFacture - totalPaye)}</p></div>
            </div>
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden border">
                <table class="w-full">
                    <thead class="bg-stone-100"><tr><th class="px-4 py-3 text-left">Facture</th><th class="px-4 py-3 text-left">Client</th><th class="px-4 py-3 text-left">Date</th><th class="px-4 py-3 text-left">Échéance</th><th class="px-4 py-3 text-right">Montant</th><th class="px-4 py-3 text-center">Statut</th></tr></thead>
                    <tbody class="divide-y">
                        ${data.factures.map(f => {
                            const isPaye = data.paiements?.find(p => p.numero === f.numero)?.paye;
                            const isLate = !isPaye && new Date(f.dateEcheance) < new Date();
                            return `<tr class="${isPaye ? 'bg-emerald-50/50' : isLate ? 'bg-red-50/50' : ''}">
                                <td class="px-4 py-3 font-medium">${f.numero}</td>
                                <td class="px-4 py-3">${getClientName(f)}</td>
                                <td class="px-4 py-3">${formatDate(f.date)}</td>
                                <td class="px-4 py-3 ${isLate ? 'text-red-600 font-medium' : ''}">${formatDate(f.dateEcheance)} ${isLate ? '⚠️' : ''}</td>
                                <td class="px-4 py-3 text-right font-medium">${formatMoney(f.totalTTC)}</td>
                                <td class="px-4 py-3 text-center">
                                    <button onclick="togglePaiement('${f.numero}')" class="px-3 py-1 rounded-full text-sm font-medium ${isPaye ? 'bg-emerald-100 text-emerald-700' : 'bg-red-100 text-red-700'}">
                                        ${isPaye ? '✓ Payé' : 'Non payé'}
                                    </button>
                                </td>
                            </tr>`;
                        }).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

function togglePaiement(numero) {
    if (!data.paiements) data.paiements = [];
    const idx = data.paiements.findIndex(p => p.numero === numero);
    if (idx !== -1) data.paiements.splice(idx, 1);
    else data.paiements.push({ numero, paye: true, date: new Date().toISOString().split('T')[0] });
    saveData();
    renderPage();
}

// ============================================
// RELANCES
// ============================================
function renderRelances() {
    const today = new Date();
    const facturesImpayees = data.factures.filter(f => {
        const isPaye = data.paiements?.find(p => p.numero === f.numero)?.paye;
        return !isPaye;
    });
    const facturesEnRetard = facturesImpayees.filter(f => new Date(f.dateEcheance) < today);

    return `
        <div class="space-y-6">
            <h2 class="text-2xl font-bold text-stone-800">Lettres de Relance</h2>
            
            <div class="bg-amber-50 border border-amber-200 rounded-xl p-4">
                <h3 class="font-semibold text-amber-800 mb-2">📬 ${facturesEnRetard.length} facture(s) en retard de paiement</h3>
                <p class="text-sm text-amber-700">Sélectionnez une facture pour générer une lettre de relance</p>
            </div>

            <div class="bg-white rounded-2xl shadow-lg overflow-hidden border">
                <table class="w-full">
                    <thead class="bg-stone-100">
                        <tr>
                            <th class="px-4 py-3 text-left">Facture</th>
                            <th class="px-4 py-3 text-left">Client</th>
                            <th class="px-4 py-3 text-left">Échéance</th>
                            <th class="px-4 py-3 text-right">Montant</th>
                            <th class="px-4 py-3 text-center">Retard</th>
                            <th class="px-4 py-3 text-center">Relances</th>
                            <th class="px-4 py-3 text-right">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y">
                        ${facturesEnRetard.map(f => {
                            const client = getClient(f.clientId);
                            const joursRetard = Math.floor((today - new Date(f.dateEcheance)) / (1000 * 60 * 60 * 24));
                            const nbRelances = data.relances?.filter(r => r.factureNumero === f.numero).length || 0;
                            return `
                                <tr class="hover:bg-red-50/50">
                                    <td class="px-4 py-3 font-medium">${f.numero}</td>
                                    <td class="px-4 py-3">${client?.nom || '-'}</td>
                                    <td class="px-4 py-3 text-red-600">${formatDate(f.dateEcheance)}</td>
                                    <td class="px-4 py-3 text-right font-medium">${formatMoney(f.totalTTC)}</td>
                                    <td class="px-4 py-3 text-center"><span class="px-2 py-1 bg-red-100 text-red-700 rounded-full text-sm">${joursRetard} j</span></td>
                                    <td class="px-4 py-3 text-center">${nbRelances}</td>
                                    <td class="px-4 py-3 text-right space-x-1">
                                        <button onclick="previewRelance('${f.numero}', 1)" class="px-2 py-1 bg-amber-100 text-amber-700 rounded text-sm" title="1ère relance">R1</button>
                                        <button onclick="previewRelance('${f.numero}', 2)" class="px-2 py-1 bg-orange-100 text-orange-700 rounded text-sm" title="2ème relance">R2</button>
                                        <button onclick="previewRelance('${f.numero}', 3)" class="px-2 py-1 bg-red-100 text-red-700 rounded text-sm" title="Mise en demeure">MD</button>
                                    </td>
                                </tr>
                            `;
                        }).join('') || '<tr><td colspan="7" class="px-4 py-8 text-center text-stone-400">Aucune facture en retard 🎉</td></tr>'}
                    </tbody>
                </table>
            </div>

            ${data.relances?.length > 0 ? `
            <div class="bg-white rounded-2xl p-6 border">
                <h3 class="font-semibold text-stone-800 mb-4">Historique des relances</h3>
                <div class="space-y-2">
                    ${data.relances.slice(-10).reverse().map(r => `
                        <div class="flex justify-between items-center py-2 border-b border-stone-100">
                            <div><span class="font-medium">${r.factureNumero}</span> - ${r.clientNom}</div>
                            <div class="flex items-center gap-3">
                                <span class="text-sm text-stone-500">${formatDate(r.date)}</span>
                                <span class="px-2 py-1 ${r.type === 'email' ? 'bg-blue-100 text-blue-700' : 'bg-stone-100 text-stone-700'} rounded text-xs">${r.type === 'email' ? '📧 Email' : '📄 Courrier'}</span>
                                <span class="px-2 py-1 bg-amber-100 text-amber-700 rounded text-xs">Niveau ${r.niveau}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            ` : ''}
        </div>
    `;
}

function previewRelance(factureNumero, niveau) {
    const f = data.factures.find(x => x.numero === factureNumero);
    const client = getClient(f.clientId);
    const joursRetard = Math.floor((new Date() - new Date(f.dateEcheance)) / (1000 * 60 * 60 * 24));
    
    const titres = {
        1: 'PREMIÈRE RELANCE - Rappel de paiement',
        2: 'DEUXIÈME RELANCE - Facture impayée',
        3: 'MISE EN DEMEURE'
    };
    
    const textes = {
        1: `Madame, Monsieur,

Sauf erreur de notre part, nous n'avons pas reçu le règlement de la facture référencée ci-dessous, arrivée à échéance le ${formatDate(f.dateEcheance)}.

Facture n° : ${f.numero}
Montant : ${formatMoney(f.totalTTC)}
Date d'échéance : ${formatDate(f.dateEcheance)}

Nous vous remercions de bien vouloir procéder au règlement de cette somme dans les meilleurs délais.

Si votre règlement s'est croisé avec ce courrier, nous vous prions de ne pas tenir compte de ce rappel.

Nous restons à votre disposition pour tout renseignement complémentaire.

Cordialement,
${data.entreprise.nom}`,

        2: `Madame, Monsieur,

Malgré notre précédent rappel, nous constatons que notre facture n'a toujours pas été réglée.

Facture n° : ${f.numero}
Montant : ${formatMoney(f.totalTTC)}
Retard : ${joursRetard} jours

Nous vous mettons en demeure de procéder au règlement de cette somme sous 8 jours.

À défaut de règlement dans ce délai, nous nous verrons dans l'obligation d'engager des poursuites pour le recouvrement de notre créance, ce qui entraînerait des frais supplémentaires à votre charge.

Cordialement,
${data.entreprise.nom}`,

        3: `Madame, Monsieur,

MISE EN DEMEURE

Par la présente, nous vous mettons en demeure de nous régler la somme de ${formatMoney(f.totalTTC)} correspondant à la facture n° ${f.numero} du ${formatDate(f.date)}, demeurée impayée malgré nos précédents rappels.

À défaut de règlement dans un délai de 8 jours à compter de la réception de ce courrier, nous transmettrons ce dossier à notre service contentieux / notre avocat pour recouvrement judiciaire, sans autre avis de notre part.

Les frais de procédure seront intégralement à votre charge.

Fait pour servir et valoir ce que de droit.

${data.entreprise.nom}`
    };

    const content = `
        <div class="space-y-4">
            <div class="bg-${niveau === 3 ? 'red' : 'amber'}-50 border border-${niveau === 3 ? 'red' : 'amber'}-200 rounded-xl p-4">
                <h3 class="font-bold text-${niveau === 3 ? 'red' : 'amber'}-800">${titres[niveau]}</h3>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-stone-50 rounded-xl p-4">
                    <p class="text-sm text-stone-500">Expéditeur</p>
                    <p class="font-medium">${data.entreprise.nom}</p>
                    <p class="text-sm">${data.entreprise.adresse}<br>${data.entreprise.codePostal} ${data.entreprise.ville}</p>
                </div>
                <div class="bg-stone-50 rounded-xl p-4">
                    <p class="text-sm text-stone-500">Destinataire</p>
                    <p class="font-medium">${client?.nom || '-'}</p>
                    <p class="text-sm">${client?.adresse || ''}<br>${client?.codePostal || ''} ${client?.ville || ''}</p>
                    ${client?.email ? `<p class="text-sm text-blue-600">${client.email}</p>` : '<p class="text-sm text-red-500">⚠️ Pas d\'email</p>'}
                </div>
            </div>

            <div class="bg-white border rounded-xl p-6">
                <p class="text-right text-sm text-stone-500 mb-4">${data.entreprise.ville}, le ${formatDate(new Date().toISOString())}</p>
                <p class="mb-4">Objet : ${titres[niveau]}</p>
                <div class="whitespace-pre-line text-sm leading-relaxed">${textes[niveau]}</div>
            </div>
        </div>
        
        <div class="flex justify-between mt-6">
            <button onclick="closeModal()" class="px-4 py-2.5 bg-stone-100 text-stone-700 rounded-xl font-medium">Fermer</button>
            <div class="flex gap-3">
                ${client?.email ? `<button onclick="sendRelanceEmail('${f.numero}', ${niveau}, '${client.email}')" class="px-4 py-2.5 bg-blue-500 text-white rounded-xl font-medium">📧 Envoyer par email</button>` : ''}
                <button onclick="printRelance('${f.numero}', ${niveau})" class="btn-primary text-white px-4 py-2.5 rounded-xl font-medium">🖨️ Imprimer</button>
            </div>
        </div>
    `;
    
    showModal(titres[niveau], content, 'max-w-3xl');
}

function sendRelanceEmail(factureNumero, niveau, email) {
    const f = data.factures.find(x => x.numero === factureNumero);
    const client = getClient(f.clientId);
    
    const sujets = {
        1: `Rappel de paiement - Facture ${f.numero}`,
        2: `Relance urgente - Facture impayée ${f.numero}`,
        3: `MISE EN DEMEURE - Facture ${f.numero}`
    };
    
    const corps = `Facture ${f.numero} - Montant: ${formatMoney(f.totalTTC)} - Échéance: ${formatDate(f.dateEcheance)}`;
    
    // Ouvrir le client mail
    const mailtoLink = `mailto:${email}?subject=${encodeURIComponent(sujets[niveau])}&body=${encodeURIComponent(corps)}`;
    window.open(mailtoLink);
    
    // Enregistrer la relance
    if (!data.relances) data.relances = [];
    data.relances.push({
        factureNumero: f.numero,
        clientNom: client?.nom || '-',
        date: new Date().toISOString().split('T')[0],
        type: 'email',
        niveau: niveau
    });
    saveData();
    
    alert('Email préparé ! Votre client mail va s\'ouvrir.');
    closeModal();
    renderPage();
}

function printRelance(factureNumero, niveau) {
    const f = data.factures.find(x => x.numero === factureNumero);
    const client = getClient(f.clientId);
    const joursRetard = Math.floor((new Date() - new Date(f.dateEcheance)) / (1000 * 60 * 60 * 24));
    
    const titres = { 1: 'PREMIÈRE RELANCE', 2: 'DEUXIÈME RELANCE', 3: 'MISE EN DEMEURE' };
    const textes = {
        1: `Sauf erreur de notre part, nous n'avons pas reçu le règlement de la facture référencée ci-dessous.\n\nFacture n° : ${f.numero}\nMontant : ${formatMoney(f.totalTTC)}\nÉchéance : ${formatDate(f.dateEcheance)}\n\nNous vous remercions de bien vouloir procéder au règlement dans les meilleurs délais.`,
        2: `Malgré notre précédent rappel, notre facture n'a toujours pas été réglée.\n\nFacture n° : ${f.numero}\nMontant : ${formatMoney(f.totalTTC)}\nRetard : ${joursRetard} jours\n\nNous vous mettons en demeure de régler sous 8 jours.`,
        3: `MISE EN DEMEURE\n\nNous vous mettons en demeure de nous régler ${formatMoney(f.totalTTC)} correspondant à la facture n° ${f.numero}.\n\nÀ défaut sous 8 jours, nous transmettrons ce dossier au contentieux.`
    };

    const printWindow = window.open('', '', 'width=800,height=600');
    printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>Relance ${f.numero}</title>
            <style>
                body { font-family: Arial, sans-serif; padding: 40px; font-size: 12px; line-height: 1.6; }
                .header { margin-bottom: 50px; }
                .expediteur { margin-bottom: 30px; }
                .destinataire { margin-bottom: 30px; text-align: right; }
                .date { text-align: right; margin-bottom: 30px; }
                .objet { font-weight: bold; margin-bottom: 30px; ${niveau === 3 ? 'color: red;' : ''} }
                .corps { white-space: pre-line; }
                .signature { margin-top: 50px; }
            </style>
        </head>
        <body>
            <div class="header">
                <div class="expediteur">
                    ${data.logo ? `<img src="${data.logo}" style="max-height:50px;margin-bottom:10px"><br>` : `<strong>${data.entreprise.nom}</strong><br>`}
                    ${data.entreprise.adresse}<br>
                    ${data.entreprise.codePostal} ${data.entreprise.ville}<br>
                    Tél: ${data.entreprise.telephone}
                </div>
                <div class="destinataire">
                    <strong>${client?.nom || '-'}</strong><br>
                    ${client?.adresse || ''}<br>
                    ${client?.codePostal || ''} ${client?.ville || ''}
                </div>
                <div class="date">${data.entreprise.ville}, le ${formatDate(new Date().toISOString())}</div>
            </div>
            <div class="objet">Objet : ${titres[niveau]}</div>
            <div class="corps">Madame, Monsieur,\n\n${textes[niveau]}\n\nCordialement,</div>
            <div class="signature">${data.entreprise.nom}</div>
        </body>
        </html>
    `);
    printWindow.document.close();
    printWindow.print();

    // Enregistrer
    if (!data.relances) data.relances = [];
    data.relances.push({
        factureNumero: f.numero,
        clientNom: client?.nom || '-',
        date: new Date().toISOString().split('T')[0],
        type: 'courrier',
        niveau: niveau
    });
    saveData();
}

// ============================================
// CHIFFRE D'AFFAIRES
// ============================================
function renderCA() {
    const mois = ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'];

    const caParMois = mois.map((nom, i) => {
        const yearMonth = `${caYear}-${String(i + 1).padStart(2, '0')}`;
        const facturesMois = data.factures.filter(f => {
            const d = new Date(f.date);
            return d.getFullYear() === caYear && d.getMonth() === i;
        });
        const ca = facturesMois.reduce((sum, f) => sum + (f.totalHT || 0), 0);
        const taux = getTauxURSSAF(yearMonth);
        return { mois: nom, yearMonth, ca, nbFactures: facturesMois.length, taux };
    });

    const totalAnnee = caParMois.reduce((sum, m) => sum + m.ca, 0);
    const totalCotisations = caParMois.reduce((sum, m) => sum + (m.ca * m.taux / 100), 0);
    const maxCA = Math.max(...caParMois.map(m => m.ca), 1);

    return `
        <div class="space-y-6">
            <div class="flex items-center justify-between">
                <h2 class="text-2xl font-bold text-stone-800">Chiffre d'Affaires ${caYear}</h2>
                <div class="flex items-center gap-2">
                    <button onclick="caYear--; renderPage()" class="p-2 hover:bg-stone-200 rounded-lg text-xl">◀</button>
                    <span class="text-lg font-semibold w-20 text-center">${caYear}</span>
                    <button onclick="caYear++; renderPage()" class="p-2 hover:bg-stone-200 rounded-lg text-xl">▶</button>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="bg-gradient-to-br from-amber-500 to-orange-500 text-white rounded-2xl p-6 shadow-lg">
                    <p class="text-amber-100">CA Total ${caYear}</p>
                    <p class="text-4xl font-bold mt-2">${formatMoney(totalAnnee)}</p>
                </div>
                <div class="bg-gradient-to-br from-stone-700 to-stone-800 text-white rounded-2xl p-6 shadow-lg">
                    <p class="text-stone-300">Cotisations URSSAF estimées</p>
                    <p class="text-4xl font-bold mt-2">${formatMoney(totalCotisations)}</p>
                </div>
            </div>

            <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
                <p class="text-sm text-blue-800">💡 <strong>Taux URSSAF par mois :</strong> Cliquez sur le taux pour le modifier individuellement. Le taux par défaut est ${(data.tauxURSSAFParMois['default'] || 23.20).toFixed(2).replace('.', ',')}%</p>
            </div>

            <div class="bg-white rounded-2xl shadow-lg overflow-hidden border">
                <table class="w-full">
                    <thead class="bg-stone-100">
                        <tr>
                            <th class="px-4 py-3 text-left">Mois</th>
                            <th class="px-4 py-3 text-right">CA HT</th>
                            <th class="px-4 py-3 text-center">Taux URSSAF</th>
                            <th class="px-4 py-3 text-right">Cotisations</th>
                            <th class="px-4 py-3 text-center">Factures</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y">
                        ${caParMois.map(m => `
                            <tr class="${m.ca > 0 ? 'bg-amber-50/30' : ''} hover:bg-amber-50/50">
                                <td class="px-4 py-3 font-medium">${m.mois}</td>
                                <td class="px-4 py-3 text-right font-medium">${formatMoney(m.ca)}</td>
                                <td class="px-4 py-3 text-center">
                                    <button onclick="editTauxMois('${m.yearMonth}', ${m.taux})" class="px-3 py-1 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 font-medium">
                                        ${m.taux.toFixed(2).replace('.', ',')}%
                                    </button>
                                </td>
                                <td class="px-4 py-3 text-right text-stone-600">${formatMoney(m.ca * m.taux / 100)}</td>
                                <td class="px-4 py-3 text-center">${m.nbFactures}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                    <tfoot class="bg-stone-100 font-bold">
                        <tr>
                            <td class="px-4 py-3">TOTAL</td>
                            <td class="px-4 py-3 text-right">${formatMoney(totalAnnee)}</td>
                            <td class="px-4 py-3 text-center">-</td>
                            <td class="px-4 py-3 text-right">${formatMoney(totalCotisations)}</td>
                            <td class="px-4 py-3 text-center">${data.factures.filter(f => new Date(f.date).getFullYear() === caYear).length}</td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <div class="grid grid-cols-4 gap-4">
                ${[0, 1, 2, 3].map(q => {
                    const caT = caParMois.slice(q * 3, q * 3 + 3).reduce((sum, m) => sum + m.ca, 0);
                    const cotisT = caParMois.slice(q * 3, q * 3 + 3).reduce((sum, m) => sum + (m.ca * m.taux / 100), 0);
                    const trimLabels = ['1er trimestre', '2ème trimestre', '3ème trimestre', '4ème trimestre'];
                    return `<div class="bg-white rounded-xl p-4 border shadow-sm">
                        <p class="text-sm text-stone-500">${trimLabels[q]} ${caYear}</p>
                        <p class="text-xl font-bold text-stone-800">${formatMoney(caT)}</p>
                        <p class="text-sm text-stone-500">Cotisations : ${formatMoney(cotisT)}</p>
                    </div>`;
                }).join('')}
            </div>

            <!-- Graphique à barres -->
            <div class="bg-white rounded-2xl shadow-lg p-6 border">
                <h3 class="text-lg font-bold text-stone-800 mb-4">📊 Évolution du Chiffre d'Affaires ${caYear}</h3>
                <div class="relative" style="height: 300px;">
                    <!-- Lignes de grille horizontales -->
                    <div class="absolute inset-0 flex flex-col justify-between pointer-events-none">
                        ${[...Array(6)].map((_, i) => `
                            <div class="flex items-center w-full border-b border-stone-200">
                                <span class="text-xs text-stone-400 w-16 text-right pr-2">${formatMoney(maxCA * (5-i) / 5)}</span>
                            </div>
                        `).join('')}
                    </div>
                    <!-- Barres -->
                    <div class="absolute bottom-6 left-16 right-4 top-0 flex items-end justify-around gap-1">
                        ${caParMois.map(m => {
                            const heightPct = maxCA > 0 ? (m.ca / maxCA * 100) : 0;
                            const hasData = m.ca > 0;
                            return `
                                <div class="flex flex-col items-center flex-1" style="height: 100%;">
                                    <div class="flex-1 w-full flex flex-col justify-end items-center">
                                        ${hasData ? `<span class="text-xs font-semibold text-stone-700 mb-1">${m.ca.toFixed(2).replace('.', ',')}€</span>` : ''}
                                        <div class="w-full max-w-12 rounded-t-lg transition-all ${hasData ? 'bg-gradient-to-t from-blue-600 to-blue-400' : 'bg-stone-200'}" 
                                             style="height: ${hasData ? Math.max(heightPct, 2) : 2}%;">
                                        </div>
                                    </div>
                                    <span class="text-xs text-stone-600 mt-2 font-medium">${m.mois.substring(0, 3).toUpperCase()}</span>
                                </div>
                            `;
                        }).join('')}
                        <!-- Barre Total -->
                        <div class="flex flex-col items-center flex-1 ml-4 pl-4 border-l-2 border-stone-300" style="height: 100%;">
                            <div class="flex-1 w-full flex flex-col justify-end items-center">
                                <span class="text-xs font-bold text-amber-700 mb-1">${totalAnnee.toFixed(2).replace('.', ',')}€</span>
                                <div class="w-full max-w-12 rounded-t-lg bg-gradient-to-t from-amber-500 to-orange-400" 
                                     style="height: ${maxCA > 0 ? Math.min(totalAnnee / maxCA * 100, 100) : 0}%;">
                                </div>
                            </div>
                            <span class="text-xs text-amber-700 mt-2 font-bold">TOTAL</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function editTauxMois(yearMonth, currentTaux) {
    const moisNom = new Date(yearMonth + '-01').toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' });
    const content = `
        <div class="space-y-4">
            <p>Modifier le taux URSSAF pour <strong>${moisNom}</strong></p>
            <div>
                <label class="block text-sm font-medium text-stone-600 mb-1">Taux (%)</label>
                <input type="number" step="0.01" id="taux-mois" value="${currentTaux}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl">
            </div>
            <div class="bg-blue-50 border border-blue-200 rounded-xl p-3 text-sm text-blue-800">
                <p><strong>Rappel des taux courants :</strong></p>
                <ul class="mt-1 space-y-1">
                    <li>• Vente de marchandises : 12,30%</li>
                    <li>• Prestations de services BIC : 21,20%</li>
                    <li>• Prestations de services BNC : 21,10%</li>
                    <li>• Activités libérales : 21,10%</li>
                </ul>
            </div>
        </div>
        <div class="flex justify-end gap-3 mt-6">
            <button onclick="closeModal()" class="px-4 py-2.5 bg-stone-100 text-stone-700 rounded-xl font-medium">Annuler</button>
            <button onclick="saveTauxMois('${yearMonth}')" class="btn-primary text-white px-4 py-2.5 rounded-xl font-medium">Enregistrer</button>
        </div>
    `;
    showModal('Taux URSSAF - ' + moisNom, content, 'max-w-md');
}

function saveTauxMois(yearMonth) {
    const taux = parseFloat(document.getElementById('taux-mois').value) || 0;
    setTauxURSSAF(yearMonth, taux);
    closeModal();
    renderPage();
}

// ============================================
// PARAMÈTRES
// ============================================
function renderSettings() {
    const e = data.entreprise;
    return `
        <div class="space-y-6 max-w-4xl">
            <div class="flex items-center justify-between">
                <h2 class="text-2xl font-bold text-stone-800">⚙️ Paramètres</h2>
                <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm">🔓 Mode Admin</span>
            </div>
            
            <!-- Version et Mot de passe Admin -->
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-white rounded-2xl shadow-lg p-6 border">
                    <h3 class="font-semibold text-stone-700 mb-3">🔢 Version de l'application</h3>
                    <div class="flex items-center gap-4">
                        <div class="flex items-center gap-1">
                            <input type="number" id="version-major" value="${data.version.split('.')[0]}" min="0" class="w-16 px-2 py-2 border border-stone-300 rounded-lg text-center text-lg font-bold">
                            <span class="text-2xl text-stone-400">.</span>
                            <input type="number" id="version-minor" value="${data.version.split('.')[1]}" min="0" class="w-16 px-2 py-2 border border-stone-300 rounded-lg text-center text-lg font-bold">
                            <span class="text-2xl text-stone-400">.</span>
                            <input type="number" id="version-patch" value="${data.version.split('.')[2]}" min="0" class="w-16 px-2 py-2 border border-stone-300 rounded-lg text-center text-lg font-bold">
                        </div>
                        <button onclick="saveVersionDirect()" class="btn-primary text-white px-4 py-2 rounded-lg">💾</button>
                    </div>
                </div>
                <div class="bg-white rounded-2xl shadow-lg p-6 border">
                    <h3 class="font-semibold text-stone-700 mb-3">🔐 Mot de passe Admin</h3>
                    <button onclick="openChangePasswordModal()" class="w-full px-4 py-2.5 bg-stone-100 text-stone-700 rounded-xl font-medium hover:bg-stone-200">
                        Changer le mot de passe
                    </button>
                    <p class="text-xs text-stone-500 mt-2">Protège l'accès à cette page</p>
                </div>
            </div>
            
            <!-- Logo -->
            <div class="bg-white rounded-2xl shadow-lg p-6 border">
                <h3 class="font-semibold text-stone-700 mb-4">🖼️ Logo de l'entreprise</h3>
                <div class="flex items-center gap-6">
                    <div class="w-48 h-24 border-2 border-dashed border-stone-300 rounded-xl flex items-center justify-center bg-stone-50">
                        ${data.logo ? `<img src="${data.logo}" class="max-h-20 max-w-44">` : `<span class="text-stone-400">Aucun logo</span>`}
                    </div>
                    <div class="space-y-2">
                        <input type="file" id="logo-input" accept="image/*" onchange="uploadLogo(event)" class="hidden">
                        <button onclick="document.getElementById('logo-input').click()" class="btn-primary text-white px-4 py-2 rounded-lg">📤 Charger un logo</button>
                        ${data.logo ? `<button onclick="removeLogo()" class="block text-red-500 text-sm hover:underline">Supprimer le logo</button>` : ''}
                        <p class="text-xs text-stone-500">Format recommandé : PNG ou JPG, max 200x80px</p>
                    </div>
                </div>
            </div>

            <!-- Entreprise -->
            <div class="bg-white rounded-2xl shadow-lg p-6 border space-y-6">
                <h3 class="font-semibold text-stone-700 border-b pb-2">🏢 Informations entreprise</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="block text-sm font-medium text-stone-600 mb-1">Nom</label>
                        <input type="text" id="ent-nom" value="${e.nom}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
                    <div><label class="block text-sm font-medium text-stone-600 mb-1">Complément</label>
                        <input type="text" id="ent-complement" value="${e.complement}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
                    <div class="col-span-2"><label class="block text-sm font-medium text-stone-600 mb-1">Adresse</label>
                        <input type="text" id="ent-adresse" value="${e.adresse}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
                    <div><label class="block text-sm font-medium text-stone-600 mb-1">Code postal</label>
                        <input type="text" id="ent-cp" value="${e.codePostal}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
                    <div><label class="block text-sm font-medium text-stone-600 mb-1">Ville</label>
                        <input type="text" id="ent-ville" value="${e.ville}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
                    <div><label class="block text-sm font-medium text-stone-600 mb-1">Téléphone</label>
                        <input type="text" id="ent-tel" value="${e.telephone}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
                    <div><label class="block text-sm font-medium text-stone-600 mb-1">Email</label>
                        <input type="email" id="ent-email" value="${e.email || ''}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
                </div>
                
                <h3 class="font-semibold text-stone-700 border-b pb-2 pt-4">📋 Informations légales</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="block text-sm font-medium text-stone-600 mb-1">SIRET</label>
                        <input type="text" id="ent-siret" value="${e.siret}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
                    <div><label class="block text-sm font-medium text-stone-600 mb-1">RCS / Code APE</label>
                        <input type="text" id="ent-rcs" value="${e.rcs}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
                </div>
                
                <h3 class="font-semibold text-stone-700 border-b pb-2 pt-4">🏦 Coordonnées bancaires</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="block text-sm font-medium text-stone-600 mb-1">IBAN</label>
                        <input type="text" id="ent-iban" value="${e.iban}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
                    <div><label class="block text-sm font-medium text-stone-600 mb-1">BIC</label>
                        <input type="text" id="ent-bic" value="${e.bic}" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl"></div>
                </div>

                <h3 class="font-semibold text-stone-700 border-b pb-2 pt-4">💶 TVA et cotisations</h3>
                <label class="flex items-center gap-3 cursor-pointer">
                    <input type="checkbox" id="ent-exonere" ${e.exonereTVA ? 'checked' : ''} class="w-5 h-5 rounded text-amber-500">
                    <span>Exonéré de TVA (micro-entreprise, article 293B du CGI)</span>
                </label>
                <div class="mt-4">
                    <label class="block text-sm font-medium text-stone-600 mb-1">Taux URSSAF par défaut (%)</label>
                    <input type="number" step="0.01" id="ent-urssaf-default" value="${data.tauxURSSAFParMois['default'] || 23.20}" class="w-40 px-4 py-2.5 border border-stone-300 rounded-xl">
                </div>

                <div class="flex justify-between pt-4">
                    <button onclick="resetData()" class="px-4 py-2.5 bg-red-500 text-white rounded-xl font-medium">🔄 Réinitialiser</button>
                    <button onclick="saveSettings()" class="btn-primary text-white px-4 py-2.5 rounded-xl font-medium">✓ Enregistrer</button>
                </div>
            </div>

            <!-- CGV -->
            <div class="bg-white rounded-2xl shadow-lg p-6 border">
                <h3 class="font-semibold text-stone-700 mb-4">📜 Conditions Générales de Vente</h3>
                <textarea id="cgv-text" rows="15" class="w-full px-4 py-3 border border-stone-300 rounded-xl text-sm">${data.cgv}</textarea>
                <div class="flex justify-end mt-4">
                    <button onclick="saveCGV()" class="btn-primary text-white px-4 py-2.5 rounded-xl font-medium">Enregistrer les CGV</button>
                </div>
            </div>
        </div>
    `;
}

function saveVersionDirect() {
    const major = document.getElementById('version-major').value || '0';
    const minor = document.getElementById('version-minor').value || '0';
    const patch = document.getElementById('version-patch').value || '0';
    data.version = `${major}.${minor}.${patch}`;
    saveData();
    updateSidebarLogo();
    alert('Version mise à jour : v' + data.version);
}

function uploadLogo(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            data.logo = e.target.result;
            saveData();
            renderPage();
            updateSidebarLogo();
        };
        reader.readAsDataURL(file);
    }
}

function removeLogo() {
    if (confirm('Supprimer le logo ?')) {
        data.logo = null;
        saveData();
        renderPage();
        updateSidebarLogo();
    }
}

function openChangePasswordModal() {
    const content = `
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-stone-600 mb-1">Mot de passe actuel</label>
                <input type="password" id="old-password" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl">
            </div>
            <div>
                <label class="block text-sm font-medium text-stone-600 mb-1">Nouveau mot de passe</label>
                <input type="password" id="new-password" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl">
            </div>
            <div>
                <label class="block text-sm font-medium text-stone-600 mb-1">Confirmer le nouveau mot de passe</label>
                <input type="password" id="confirm-password" class="w-full px-4 py-2.5 border border-stone-300 rounded-xl">
            </div>
        </div>
        <div class="flex justify-end gap-3 mt-6">
            <button onclick="closeModal()" class="px-4 py-2.5 bg-stone-100 text-stone-700 rounded-xl font-medium">Annuler</button>
            <button onclick="changePassword()" class="btn-primary text-white px-4 py-2.5 rounded-xl font-medium">Changer</button>
        </div>
    `;
    showModal('Changer le mot de passe', content, 'max-w-md');
}

function changePassword() {
    const oldPwd = document.getElementById('old-password').value;
    const newPwd = document.getElementById('new-password').value;
    const confirmPwd = document.getElementById('confirm-password').value;

    if (oldPwd !== data.adminPassword) {
        alert('Mot de passe actuel incorrect !');
        return;
    }
    if (newPwd !== confirmPwd) {
        alert('Les nouveaux mots de passe ne correspondent pas !');
        return;
    }
    if (newPwd.length < 4) {
        alert('Le mot de passe doit faire au moins 4 caractères !');
        return;
    }

    data.adminPassword = newPwd;
    saveData();
    closeModal();
    alert('Mot de passe modifié avec succès !');
}

function saveSettings() {
    data.entreprise = {
        nom: document.getElementById('ent-nom').value,
        complement: document.getElementById('ent-complement').value,
        adresse: document.getElementById('ent-adresse').value,
        codePostal: document.getElementById('ent-cp').value,
        ville: document.getElementById('ent-ville').value,
        telephone: document.getElementById('ent-tel').value,
        email: document.getElementById('ent-email').value,
        siret: document.getElementById('ent-siret').value,
        rcs: document.getElementById('ent-rcs').value,
        iban: document.getElementById('ent-iban').value,
        bic: document.getElementById('ent-bic').value,
        exonereTVA: document.getElementById('ent-exonere').checked
    };
    data.tauxURSSAFParMois['default'] = parseFloat(document.getElementById('ent-urssaf-default').value) || 23.20;
    saveData();
    updateSidebarLogo();
    alert('Paramètres enregistrés !');
}

function saveCGV() {
    data.cgv = document.getElementById('cgv-text').value;
    saveData();
    alert('CGV enregistrées !');
}

function resetData() {
    if (confirm('⚠️ ATTENTION !\n\nCela va réinitialiser TOUTES les données.\nContinuer ?')) {
        localStorage.removeItem('facturier_stylemoi_v3');
        location.reload();
    }
}

// ============================================
// RENDU PRINCIPAL
// ============================================
function renderPage() {
    const main = document.getElementById('main-content');
    switch (currentTab) {
        case 'dashboard': main.innerHTML = renderDashboard(); break;
        case 'clients': main.innerHTML = renderClients(); break;
        case 'produits': main.innerHTML = renderProduits(); break;
        case 'devis': main.innerHTML = renderDevis(); break;
        case 'factures': main.innerHTML = renderFactures(); break;
        case 'paiements': main.innerHTML = renderPaiements(); break;
        case 'relances': main.innerHTML = renderRelances(); break;
        case 'ca': main.innerHTML = renderCA(); break;
        case 'settings': main.innerHTML = renderSettings(); break;
        default: main.innerHTML = renderDashboard();
    }
}

// ============================================
// INITIALISATION
// ============================================
document.addEventListener('DOMContentLoaded', checkSession);

document.getElementById('modal-container').addEventListener('click', function(e) {
    if (e.target === this) closeModal();
});
</script>
</body>
</html>
